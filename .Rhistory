# Step 1: Filter for the state's players
football_rosters_nc <- football_rosters_usa %>%
filter(hometown_state_clean == "NC")
# Step 2: Get a list of all the unique hometowns in the state
distinct_hometowns_nc <- football_rosters_nc %>%
group_by(hometown_city_clean, hometown_state_clean) %>%
summarise(total_players = n())
# Step 3: Grab the relevant census data for that state. Note: B01003 = total population, B02001 = total Black population, B19013 = median household income. We get these codes using the ACS crosswalk we loaded earlier (ACS_2001) and this website: https://censusreporter.org/topics/table-codes/
census_data_nc_2021 <- get_acs(geography = "place",
variables = c("B01003_001", "B02001_003", "B19013_001"),
year = 2021,
state = "NC",
output = "wide")
View(census_data_nc_2021)
View(football_rosters_nc)
# Step 4: General cleaning of census data to prepare for join with hometowns/roster data. This part is the same for every state and (except for the dataframe name) can more or less be copied and pasted.
census_data_nc_2021 <- census_data_nc_2021 %>%
clean_names() %>%
separate(name, into = c("city", "state"), sep = ", ", remove = FALSE) %>%
mutate(city = gsub("\\b(town|city|CDP|village)\\b", "", city)) %>%
mutate(city = str_squish(city)) %>%
select(geoid, city, state, b01003_001e, b02001_003e, b19013_001e) %>%
rename(total_pop = b01003_001e, black_pop = b02001_003e, median_income = b19013_001e) %>%
mutate(pct_black = round(black_pop/total_pop*100, 1))
# Step 5: State-specific cleaning of census data to prepare for join with hometowns/roster data. This part is different for every state. The first mutate function should be included for every state, just modified depending on the state name. Additional mutate functions may be needed for instances when the census names something in a weird way that doesn't line up with the hometowns.
census_data_nc_2021 <- census_data_nc_2021 %>%
mutate(state = case_when(
state == 'North Carolina' ~ "NC")) %>%
filter(geoid != "3722500") #removed a Fairview, NC that is a town in Union County and keeping a Fairview, NC that is near Ashville
# Step 6: Join the census data to the list of hometowns. Also create a column that tells us how many people are elite college football players for every 1,000 residents.
hometowns_nc_complete <- distinct_hometowns_nc %>%
left_join(census_data_nc_2021, by = c("hometown_city_clean" = "city", "hometown_state_clean" = "state")) %>%
mutate(players_per_thousand = round((total_players*1000)/total_pop,1)) %>%
arrange(desc(players_per_thousand))
View(hometowns_nc_complete)
# For Arden, NC (28704), the zip code seems to be good substitutes: https://censusreporter.org/profiles/86000US28704-28704/
census_data_arden_nc_2021 <- get_acs(geography = "zcta",
variables = c("B01003_001", "B02001_003", "B19013_001"),
year = 2021,
output = "wide") %>%
clean_names() %>%
filter(name == "ZCTA5 28704") %>%
rename(city = name, total_pop = b01003_001e, black_pop = b02001_003e, median_income = b19013_001e) %>%
mutate(pct_black = round(black_pop/total_pop*100, 1)) %>%
mutate(state = "NC") %>%
mutate(city = case_when(
city == "ZCTA5 28704" ~ "Arden")) %>%
select(geoid, city, state, total_pop, black_pop, median_income, pct_black)
# Step 9: We now have to append these special cases to our state census data, redo the join, and run one more check for NA values.
census_data_nc_2021 <- bind_rows(census_data_nc_2021, census_data_arden_nc_2021)
hometowns_nc_complete <- distinct_hometowns_nc %>%
left_join(census_data_nc_2021, by = c("hometown_city_clean" = "city", "hometown_state_clean" = "state")) %>%
mutate(players_per_thousand = round((total_players*1000)/total_pop,1)) %>%
arrange(desc(players_per_thousand))
View(distinct_hometowns_complete)
# Step 1: Filter for the state's players
football_rosters_ma <- football_rosters_usa %>%
filter(hometown_state_clean == "MA")
# Step 2: Get a list of all the unique hometowns in the state
distinct_hometowns_ma <- football_rosters_ma %>%
group_by(hometown_city_clean, hometown_state_clean) %>%
summarise(total_players = n())
# Step 3: Grab the relevant census data for that state. Note: B01003 = total population, B02001 = total Black population, B19013 = median household income. We get these codes using the ACS crosswalk we loaded earlier (ACS_2001) and this website: https://censusreporter.org/topics/table-codes/
census_data_ma_2021 <- get_acs(geography = "place",
variables = c("B01003_001", "B02001_003", "B19013_001"),
year = 2021,
state = "MA",
output = "wide")
View(census_data_ma_2021)
# It turns out that many towns in Massachusetts are county subdivisions, so we will grab some of those we need, too
census_data_ma_subdivisions_2021 <- get_acs(geography = "county subdivision",
variables = c("B01003_001", "B02001_003", "B19013_001"),
year = 2021,
state = "MA",
output = "wide") %>%
filter(NAME == "Acton town, Middlesex County, Massachusetts" | NAME == "Canton town, Norfolk County, Massachusetts" | NAME == "Concord town, Middlesex County, Massachusetts" |  NAME == "Holliston town, Middlesex County, Massachusetts" | NAME == "Mansfield town, Bristol County, Massachusetts" | NAME == "Newbury town, Essex County, Massachusetts" | NAME == "North Andover town, Essex County, Massachusetts" | NAME == "Norwell town, Plymouth County, Massachusetts" | NAME == "Paxton town, Worcester County, Massachusetts" | NAME == "Raynham town, Bristol County, Massachusetts" | NAME == "Sudbury town, Middlesex County, Massachusetts" | NAME == "Westborough town, Worcester County, Massachusetts")
View(census_data_ma_subdivisions_2021)
View(football_rosters_ma)
# Step 1: Filter for the state's players
football_rosters_ma <- football_rosters_usa %>%
filter(hometown_state_clean == "MA")
# Step 2: Get a list of all the unique hometowns in the state
distinct_hometowns_ma <- football_rosters_ma %>%
group_by(hometown_city_clean, hometown_state_clean) %>%
summarise(total_players = n())
# Step 3: Grab the relevant census data for that state. Note: B01003 = total population, B02001 = total Black population, B19013 = median household income. We get these codes using the ACS crosswalk we loaded earlier (ACS_2001) and this website: https://censusreporter.org/topics/table-codes/
census_data_ma_2021 <- get_acs(geography = "place",
variables = c("B01003_001", "B02001_003", "B19013_001"),
year = 2021,
state = "MA",
output = "wide")
# It turns out that many towns in Massachusetts are county subdivisions, so we will grab some of those we need, too
census_data_ma_subdivisions_2021 <- get_acs(geography = "county subdivision",
variables = c("B01003_001", "B02001_003", "B19013_001"),
year = 2021,
state = "MA",
output = "wide") %>%
filter(NAME == "Acton town, Middlesex County, Massachusetts" | NAME == "Canton town, Norfolk County, Massachusetts" | NAME == "Concord town, Middlesex County, Massachusetts" |  NAME == "Holliston town, Middlesex County, Massachusetts" | NAME == "Mansfield town, Bristol County, Massachusetts" | NAME == "Newbury town, Essex County, Massachusetts" | NAME == "North Andover town, Essex County, Massachusetts" | NAME == "Norwell town, Plymouth County, Massachusetts" | NAME == "Paxton town, Worcester County, Massachusetts" | NAME == "Raynham town, Bristol County, Massachusetts" | NAME == "Sudbury town, Middlesex County, Massachusetts" | NAME == "Westborough town, Worcester County, Massachusetts")
# Step 4: General cleaning of census data to prepare for join with hometowns/roster data. This part is the same for every state and (except for the dataframe name) can more or less be copied and pasted.
census_data_ma_2021 <- census_data_ma_2021 %>%
clean_names() %>%
separate(name, into = c("city", "state"), sep = ", ", remove = FALSE) %>%
mutate(city = gsub("\\b(town|city|CDP|village)\\b", "", city)) %>%
mutate(city = str_squish(city)) %>%
select(geoid, city, state, b01003_001e, b02001_003e, b19013_001e) %>%
rename(total_pop = b01003_001e, black_pop = b02001_003e, median_income = b19013_001e) %>%
mutate(pct_black = round(black_pop/total_pop*100, 1))
census_data_ma_subdivisions_2021 <- census_data_ma_subdivisions_2021 %>%
clean_names() %>%
separate(name, into = c("city", "county", "state"), sep = ", ", remove = FALSE) %>%
mutate(city = gsub("\\b(town|city|CDP|village|municipality|township)\\b", "", city)) %>%
mutate(city = str_squish(city)) %>%
select(geoid, city, state, b01003_001e, b02001_003e, b19013_001e) %>%
rename(total_pop = b01003_001e, black_pop = b02001_003e, median_income = b19013_001e) %>%
mutate(pct_black = round(black_pop/total_pop*100, 1))
census_data_ma_2021 <- bind_rows(census_data_ma_2021, census_data_ma_subdivisions_2021)
# Step 5: State-specific cleaning of census data to prepare for join with hometowns/roster data. This part is different for every state. The first mutate function should be included for every state, just modified depending on the state name. Additional mutate functions may be needed for instances when the census names something in a weird way that doesn't line up with the hometowns.
census_data_ma_2021 <- census_data_ma_2021 %>%
mutate(state = case_when(
state == 'Massachusetts' ~ "MA")) %>%
mutate(city = case_when(
city == 'Franklin Town' ~ "Franklin",
city == 'Watertown Town' ~ "Watertown",
TRUE ~ city)) %>%
filter(geoid != "2575050") #removed a Westborough CDP
# Step 6: Join the census data to the list of hometowns. Also create a column that tells us how many people are elite college football players for every 1,000 residents.
hometowns_ma_complete <- distinct_hometowns_ma %>%
left_join(census_data_ma_2021, by = c("hometown_city_clean" = "city", "hometown_state_clean" = "state")) %>%
mutate(players_per_thousand = round((total_players*1000)/total_pop,1)) %>%
arrange(desc(players_per_thousand))
# ALL HOMETOWNS
hometowns_complete <- bind_rows(hometowns_al_complete, hometowns_ar_complete, hometowns_az_complete, hometowns_ca_complete, hometowns_co_complete, hometowns_fl_complete, hometowns_ga_complete, hometowns_hi_complete, hometowns_ia_complete, hometowns_il_complete, hometowns_in_complete, hometowns_ks_complete, hometowns_ky_complete, hometowns_la_complete, hometowns_ma_complete, hometowns_md_complete, hometowns_mi_complete, hometowns_mo_complete, hometowns_mn_complete, hometowns_ms_complete, hometowns_nc_complete, hometowns_ne_complete, hometowns_nj_complete, hometowns_ny_complete, hometowns_oh_complete, hometowns_ok_complete, hometowns_or_complete, hometowns_pa_complete, hometowns_sc_complete, hometowns_tn_complete, hometowns_tx_complete, hometowns_ut_complete, hometowns_va_complete, hometowns_wa_complete, hometowns_wi_complete, hometowns_small_states_complete) %>%
mutate(hometown_combined = paste(hometown_city_clean, hometown_state_clean, sep = ", ")) %>%
arrange(desc(players_per_thousand)) %>%
select(hometown_city_clean:hometown_state_clean, hometown_combined, total_players:players_per_thousand)
View(hometowns_complete)
#Making sure each hometown is represented once
distinct_hometowns_complete <- hometowns_complete %>%
group_by(hometown_city_clean, hometown_state_clean) %>%
summarise(total=n()) %>%
arrange(desc(total))
View(distinct_hometowns_complete)
# Step 1: Filter for the state's players
football_rosters_ca <- football_rosters_usa %>%
filter(hometown_state_clean == "CA")
# Step 2: Get a list of all the unique hometowns in the state
distinct_hometowns_ca <- football_rosters_ca %>%
group_by(hometown_city_clean, hometown_state_clean) %>%
summarise(total_players = n())
# Step 3: Grab the relevant census data for that state. Note: B01003 = total population, B02001 = total Black population, B19013 = median household income. We get these codes using the ACS crosswalk we loaded earlier (ACS_2001) and this website: https://censusreporter.org/topics/table-codes/
census_data_ca_2021 <- get_acs(geography = "place",
variables = c("B01003_001", "B02001_003", "B19013_001"),
year = 2021,
state = "CA",
output = "wide")
View(census_data_ca_2021)
View(football_rosters_ca)
# Step 1: Filter for the state's players
football_rosters_ca <- football_rosters_usa %>%
filter(hometown_state_clean == "CA")
# Step 2: Get a list of all the unique hometowns in the state
distinct_hometowns_ca <- football_rosters_ca %>%
group_by(hometown_city_clean, hometown_state_clean) %>%
summarise(total_players = n())
# Step 3: Grab the relevant census data for that state. Note: B01003 = total population, B02001 = total Black population, B19013 = median household income. We get these codes using the ACS crosswalk we loaded earlier (ACS_2001) and this website: https://censusreporter.org/topics/table-codes/
census_data_ca_2021 <- get_acs(geography = "place",
variables = c("B01003_001", "B02001_003", "B19013_001"),
year = 2021,
state = "CA",
output = "wide")
# Step 4: General cleaning of census data to prepare for join with hometowns/roster data. This part is the same for every state and (except for the dataframe name) can more or less be copied and pasted.
census_data_ca_2021 <- census_data_ca_2021 %>%
clean_names() %>%
separate(name, into = c("city", "state"), sep = ", ", remove = FALSE) %>%
mutate(city = gsub("\\b(town|city|CDP|village)\\b", "", city)) %>%
mutate(city = str_squish(city)) %>%
select(geoid, city, state, b01003_001e, b02001_003e, b19013_001e) %>%
rename(total_pop = b01003_001e, black_pop = b02001_003e, median_income = b19013_001e) %>%
mutate(pct_black = round(black_pop/total_pop*100, 1))
# Step 5: State-specific cleaning of census data to prepare for join with hometowns/roster data. This part is different for every state. The first mutate function should be included for every state, just modified depending on the state name. Additional mutate functions may be needed for instances when the census names something in a weird way that doesn't line up with the hometowns.
census_data_ca_2021 <- census_data_ca_2021 %>%
mutate(state = case_when(
state == 'California' ~ "CA")) %>%
mutate(city = case_when(
city == 'San Buenaventura (Ventura)'~ "Ventura",
city == 'Spring Valley (San Diego County)' ~ "Spring Valley",
TRUE ~ city)) %>%
filter(geoid != "0649651") #removing a Mountain View, California that is a CDP in Contra Costa County and keeping a Mountain View, California in Santa Clara County
# Step 6: Join the census data to the list of hometowns. Also create a column that tells us how many people are elite college football players for every 1,000 residents.
hometowns_ca_complete <- distinct_hometowns_ca %>%
left_join(census_data_ca_2021, by = c("hometown_city_clean" = "city", "hometown_state_clean" = "state")) %>%
mutate(players_per_thousand = round((total_players*1000)/total_pop,1)) %>%
arrange(desc(players_per_thousand))
View(hometowns_ca_complete)
# ALL HOMETOWNS
hometowns_complete <- bind_rows(hometowns_al_complete, hometowns_ar_complete, hometowns_az_complete, hometowns_ca_complete, hometowns_co_complete, hometowns_fl_complete, hometowns_ga_complete, hometowns_hi_complete, hometowns_ia_complete, hometowns_il_complete, hometowns_in_complete, hometowns_ks_complete, hometowns_ky_complete, hometowns_la_complete, hometowns_ma_complete, hometowns_md_complete, hometowns_mi_complete, hometowns_mo_complete, hometowns_mn_complete, hometowns_ms_complete, hometowns_nc_complete, hometowns_ne_complete, hometowns_nj_complete, hometowns_ny_complete, hometowns_oh_complete, hometowns_ok_complete, hometowns_or_complete, hometowns_pa_complete, hometowns_sc_complete, hometowns_tn_complete, hometowns_tx_complete, hometowns_ut_complete, hometowns_va_complete, hometowns_wa_complete, hometowns_wi_complete, hometowns_small_states_complete) %>%
mutate(hometown_combined = paste(hometown_city_clean, hometown_state_clean, sep = ", ")) %>%
arrange(desc(players_per_thousand)) %>%
select(hometown_city_clean:hometown_state_clean, hometown_combined, total_players:players_per_thousand)
#Making sure each hometown is represented once
distinct_hometowns_complete <- hometowns_complete %>%
group_by(hometown_city_clean, hometown_state_clean) %>%
summarise(total=n()) %>%
arrange(desc(total))
View(distinct_hometowns_complete)
hometowns_complete <- bind_rows(hometowns_al_complete, hometowns_ar_complete, hometowns_az_complete, hometowns_ca_complete, hometowns_co_complete, hometowns_fl_complete, hometowns_ga_complete, hometowns_hi_complete, hometowns_ia_complete, hometowns_il_complete, hometowns_in_complete, hometowns_ks_complete, hometowns_ky_complete, hometowns_la_complete, hometowns_ma_complete, hometowns_md_complete, hometowns_mi_complete, hometowns_mo_complete, hometowns_mn_complete, hometowns_ms_complete, hometowns_nc_complete, hometowns_ne_complete, hometowns_nj_complete, hometowns_ny_complete, hometowns_oh_complete, hometowns_ok_complete, hometowns_or_complete, hometowns_pa_complete, hometowns_sc_complete, hometowns_tn_complete, hometowns_tx_complete, hometowns_ut_complete, hometowns_va_complete, hometowns_wa_complete, hometowns_wi_complete, hometowns_small_states_complete) %>%
mutate(hometown_combined = paste(hometown_city_clean, hometown_state_clean, sep = ", ")) %>%
arrange(desc(players_per_thousand))
View(hometowns_complete)
# ALL HOMETOWNS
hometowns_complete <- bind_rows(hometowns_al_complete, hometowns_ar_complete, hometowns_az_complete, hometowns_ca_complete, hometowns_co_complete, hometowns_fl_complete, hometowns_ga_complete, hometowns_hi_complete, hometowns_ia_complete, hometowns_il_complete, hometowns_in_complete, hometowns_ks_complete, hometowns_ky_complete, hometowns_la_complete, hometowns_ma_complete, hometowns_md_complete, hometowns_mi_complete, hometowns_mo_complete, hometowns_mn_complete, hometowns_ms_complete, hometowns_nc_complete, hometowns_ne_complete, hometowns_nj_complete, hometowns_ny_complete, hometowns_oh_complete, hometowns_ok_complete, hometowns_or_complete, hometowns_pa_complete, hometowns_sc_complete, hometowns_tn_complete, hometowns_tx_complete, hometowns_ut_complete, hometowns_va_complete, hometowns_wa_complete, hometowns_wi_complete, hometowns_small_states_complete) %>%
mutate(hometown_combined = paste(hometown_city_clean, hometown_state_clean, sep = ", ")) %>%
arrange(desc(players_per_thousand)) %>%
select(geoid, hometown_city_clean, hometown_state_clean, hometown_combined, total_players, total_pop, black_pop, pct_black, median_income, players_per_thousand)
#Making sure each hometown is represented once
distinct_hometowns_complete <- hometowns_complete %>%
group_by(hometown_city_clean, hometown_state_clean) %>%
summarise(total=n()) %>%
arrange(desc(total))
View(distinct_hometowns_complete)
#Making sure each state is represented
distinct_states_complete <- hometowns_complete %>%
group_by(hometown_state_clean) %>%
summarise(total=(n)) %>%
arrange(desc(total))
#Making sure each state is represented
distinct_states_complete <- hometowns_complete %>%
group_by(hometown_state_clean) %>%
summarise(total=n()) %>%
arrange(desc(total))
View(distinct_states_complete)
#Making sure each state is represented
distinct_states_complete <- hometowns_complete %>%
distinct(hometown_state_clean)
#Making sure each state is represented
distinct_states_complete <- hometowns_complete %>%
distinct(hometown_state_clean, .keep_all = TRUE)
#Making sure each state is represented
distinct_states_complete <- hometowns_complete %>%
select(hometown_state_clean) %>%
distinct(hometown_state_clean)
#Making sure each state is represented
distinct_states_complete <- hometowns_complete %>%
distinct(hometown_state_clean, .keep_all = TRUE) %>%
select(hometown_state_clean)
#Making sure each state is represented
distinct_states_complete <- unique(hometowns_complete$hometown_state_clean)
distinct_states_complete <- data.frame(hometown_state_clean = hometown_states_complete)
#Making sure each state is represented
distinct_states_vector <- unique(hometowns_complete$hometown_state_clean)
distinct_states_complete <- data.frame(hometown_state_clean = distinct_states_vector)
distinct_states_complete <- data.frame(hometown_state_clean = distinct_states_vector) %>%
arrange()
distinct_states_complete <- data.frame(hometown_state_clean = distinct_states_vector) %>%
arrange(hometown_state_clean)
write_csv(hometowns_complete, file = "hometowns_complete.csv")
View(football_rosters_usa)
View(football_rosters_ms)
#libraries
library(tidyverse)
library(googlesheets4)
library(janitor)
library(tidycensus)
#install.packages("googlesheets4")
#Authenticating with Google account
#gs4_auth()
# Load Census API key
Sys.setenv(CENSUS_API_KEY = "5cb2b9c628a1d1329c5bf4d36fe4435c6501efc8", overwrite = TRUE)
# Load ACS crosswalk
acs_2021 <- load_variables(2021, "acs5")
# Load 2020 Census crosswalk
census_2020 <- load_variables(2020, "pl", cache = TRUE)
# Helpful references for using ACS and Census APIs: #https://censusreporter.org/topics/table-codes/
#https://walker-data.com/tidycensus/articles/basic-usage.html
#Load football roster scraper. Also did some cleaning for special cases here. For the players who were missing hometown information, this was obtained by looking at rosters from previous years.
football_rosters <- read_csv("football_roster.csv") %>%
clean_names() %>%
mutate(hometown = case_when(
hometown == "Pompano, Beach, Fla." ~ "Pompano Beach, Fla.",
hometown == "Livemore Calif." ~ "Livemore, Calif.",
hometown == "Washington D.C." ~ "Washington, D.C.",
hometown == "Tampa. Fla." ~ "Tampa, Fla.",
hometown == "Upper Marlboro. Md." ~ "Upper Marlboro, Md.",
hometown == "Norfolk,Va." ~ "Norfolk, Va.",
hometown == "Bronx N.Y." ~ "Bronx, N.Y.",
hometown == "Cocoa Fla." ~ "Cocoa, Fla.",
hometown == "Jefferson" ~ "Jefferson Township, NJ",
hometown == "Melbourne" ~ "Melbourne, FL",
hometown == "Chicago" ~ "Chicago, IL",
hometown == "Cincinnati" ~ "Cincinnati, OH",
hometown == "Cleveland" ~ "Cleveland, OH",
hometown == "St. Louis" ~ "St. Louis, MO",
hometown == "Inglewood" ~ "Inglewood, CA",
hometown == "Chatworth, Ga." ~ "Chatsworth, Ga.",
hometown == "Kingland, Ga." ~ "Kingsland, Ga.",
hometown == "East Cobb, GA" ~ "Marietta, GA",
hometown == "Platville, Ala." ~ "Prattville, Ala.",
TRUE ~ hometown)) %>%
mutate(hometown = case_when(
name == "Feyisayo Oluleye" ~ "Lancaster, PA",
name == "Kyle Vaccarella" ~ "Fairfield, CT",
TRUE ~ hometown))
#Let's also use this as a time to load a state crosswalk we'll use later
state_crosswalk <- read_csv("state_crosswalk.csv") %>%
mutate(state_name_caps = str_to_upper(state_name)) %>%
select(state_abb, state_name_caps)
#Let's load some hometowns that we passed through and cleaned with Open Refine
hometowns_open_refine <- read_csv("hometowns_open_refine.csv")
#Checking to see that we have 68 schools and the player counts for each school
# school_check <- football_rosters %>%
#   group_by(school) %>%
#   summarise(total_players = n()) %>%
#   arrange(total_players)
#Checking to make sure there are no duplicate players
# player_check <- football_rosters %>%
#   group_by(name, school) %>%
#   summarise(total = n()) %>%
#   arrange(desc(total))
#CLEANING/STANDARDIZING STATE
#Splitting the hometown column so we can work with the state
football_rosters <- football_rosters %>%
mutate(hometown_cleaning = hometown) %>%
separate(hometown_cleaning, into = c("hometown_city", "hometown_state", "hometown_country"), sep = ", ")
#What kind of values are we getting in hometown_state?
state_check <- football_rosters %>%
group_by(hometown_state) %>%
summarise(total = n()) %>%
arrange(hometown_state)
#Many of those aren't U.S. states. Let's make a new dataframe that only has players from the 50 states:
excluded_states <- c(" Western Australia", "Alberta", "American Samoa", "Australia", "Bahamas", "Belgium", "Canada", "China", "Colombia", "Congo", "County Kerry", "Denmark", "DR of the Congo", "England", "Finland", "France", "Gabon", "Germany", "Ghana", "Ireland", "Japan", "Manitoba", "Mexico", "N.S.", "New South Wales", "New Zealand", "Nigeria", "NSW", "Ont.", "Ontario", "QC", "Que.", "Quebec", "Québec", "Queensland", "Saskatchewan", "Serbia", "South Africa", "South Australia", "Sweden", "Switzerland", "The Netherlands", "Tonga", "United Kingdom", "Victoria", "Victoria AU", "Western Samoa")
football_rosters_usa <- football_rosters %>%
filter(!(hometown_state %in% excluded_states) | is.na(hometown_state)) %>%
mutate(hometown_state = case_when(
hometown_state == "Maui" ~ "HI",
hometown_state == "New York City" ~ "NY",
TRUE ~ hometown_state))
#And now let's recheck those hometown_state values:
state_check_usa <- football_rosters_usa %>%
group_by(hometown_state) %>%
summarise(total = n()) %>%
arrange(hometown_state)
#Let's standardize these to the state postal abbreviation:
#First, let's try removing punctuation and making everything upper case:
football_rosters_usa <- football_rosters_usa %>%
mutate(hometown_state_first_try = str_to_upper(gsub("[[:punct:]]", "", hometown_state)))
#Second, let's see if we can use our crosswalk:
football_rosters_usa <- football_rosters_usa %>%
left_join(state_crosswalk, by=c("hometown_state_first_try" = "state_name_caps"))
football_rosters_usa <- football_rosters_usa %>%
rename(hometown_state_second_try = state_abb)
#Third, let's combine the results of our first two tries and check to see how much that reduced our unique values
football_rosters_usa <- football_rosters_usa %>%
mutate(hometown_state_third_try = ifelse(is.na(hometown_state_second_try), hometown_state_first_try, hometown_state_second_try))
state_check_usa_update <- football_rosters_usa %>%
group_by(hometown_state_third_try) %>%
summarise(total = n()) %>%
arrange(hometown_state_third_try)
#Now we're down to much fewer state values. Let's manually take care of the rest.
football_rosters_usa <- football_rosters_usa %>%
mutate(hometown_state_clean = case_when(
hometown_state_third_try == "ALA" ~ "AL",
hometown_state_third_try == "ARIZ" ~ "AZ",
hometown_state_third_try == "ARK" ~ "AR",
hometown_state_third_try == "CALF" | hometown_state_third_try == "CALIF" ~ "CA",
hometown_state_third_try == "COL" | hometown_state_third_try == "COLO" ~ "CO",
hometown_state_third_try == "CONN" ~ "CT",
hometown_state_third_try == "DEL" ~ "DE",
hometown_state_third_try == "FLA" ~ "FL",
hometown_state_third_try == "ILL" ~ "IL",
hometown_state_third_try == "IND" ~ "IN",
hometown_state_third_try == "KAN" ~ "KS",
hometown_state_third_try == "MASS" ~ "MA",
hometown_state_third_try == "MICH" ~ "MI",
hometown_state_third_try == "MINN" ~ "MN",
hometown_state_third_try == "MISS" ~ "MS",
hometown_state_third_try == "MONT" ~ "MT",
hometown_state_third_try == "NEB" ~ "NE",
hometown_state_third_try == "NEV" ~ "NV",
hometown_state_third_try == "OKLA" ~ "OK",
hometown_state_third_try == "ORE" ~ "OR",
hometown_state_third_try == "PENN" ~ "PA",
hometown_state_third_try == "TENN" ~ "TN",
hometown_state_third_try == "W VA" | hometown_state_third_try == "WVA" ~ "WV",
hometown_state_third_try == "WASH" ~ "WA",
hometown_state_third_try == "WIS" | hometown_state_third_try == "WISC" ~ "WI",
hometown_state_third_try == "WYO" ~ "WY",
TRUE ~ hometown_state_third_try))
#What's the final state breakdown?
football_rosters_usa_states <- football_rosters_usa %>%
group_by(hometown_state_clean) %>%
summarise(total_players=n()) %>%
arrange(desc(total_players))
#STATES WITH POPULATION DATA
#Let's try to add in some population data and try to figure out the number of Power 5 football players per 100,000 residents in a state
#First, let's get ourselves a dataframe that has state postal abbreviations and their most recent ACS state population:
state_pops_2021 <- get_acs(geography = "state",
variables = "B01003_001",
year = 2021)
state_pops_2021 <- state_pops_2021 %>%
clean_names() %>%
mutate(name_caps = str_to_upper(name)) %>%
mutate(name_caps = case_when(
name_caps == "DISTRICT OF COLUMBIA" ~ "WASHINGTON, DC",
TRUE ~ name_caps
)) %>%
left_join(state_crosswalk, by=c("name_caps" = "state_name_caps"))
state_pops_2021 <- state_pops_2021 %>%
select(state_abb, estimate) %>%
filter(!is.na(state_abb)) #Removed NA value, which was Puerto Rico
# Now, let's join our population data to our state count of football players data:
football_rosters_usa_states <- football_rosters_usa_states %>%
inner_join(state_pops_2021, by=c("hometown_state_clean" = "state_abb"))
football_rosters_usa_states <- football_rosters_usa_states %>%
rename(total_pop = estimate)
football_rosters_usa_states <- football_rosters_usa_states %>%
mutate(players_per_hundred_thousand = round((total_players*100000)/total_pop,1)) %>%
arrange(desc(players_per_hundred_thousand))
# CSV
#write_csv(football_rosters_usa_states, file = "state_counts.csv")
# START TO CLEAN/STANDARDIZE HOMETOWNS
# CSV - going to try cleaning this through Open Refine
#write_csv(distinct_hometowns, file = "hometowns_to_clean.csv")
#Join our Open Refine dataframe to our dataframe of Power Five players
hometowns_open_refine_modified <- hometowns_open_refine %>%
select(hometown_city, hometown_city_clean, hometown_state_clean)
football_rosters_usa <- football_rosters_usa %>%
left_join(hometowns_open_refine_modified, by = c("hometown_city", "hometown_state_clean")) %>%
mutate(hometown_city_clean = case_when(
name == 'DJ Uiagalelei' ~ "Riverside",
name == 'AJ Duffy' ~ "Moreno Valley",
name == 'Izayah  Reeves' ~ "Hempstead",
name == 'Jawhar Jordan' ~ "Farmingdale",
name == 'Anthony Gangi' ~ "Oyster Bay",
TRUE ~ hometown_city_clean)) #These lines of code are for two players from Inland Empire, California, a large region of California that includes dozens of incorporated cities, and three players from Long Island, New York.
distinct_hometowns <- football_rosters_usa %>%
group_by(hometown_city_clean, hometown_state_clean) %>%
summarise(total = n())
#From here, the best way to continue working on this will likely be state-by-state
# MISSISSIPPI HOMETOWNS
# Step 1: Filter for the state's players
football_rosters_ms <- football_rosters_usa %>%
filter(hometown_state_clean == "MS")
# Step 2: Get a list of all the unique hometowns in the state
distinct_hometowns_ms <- football_rosters_ms %>%
group_by(hometown_city_clean, hometown_state_clean) %>%
summarise(total_players = n())
# Step 3: Grab the relevant census data for that state. Note: B01003 = total population, B02001 = total Black population, B19013 = median household income. We get these codes using the ACS crosswalk we loaded earlier (ACS_2001) and this website: https://censusreporter.org/topics/table-codes/
census_data_ms_2021 <- get_acs(geography = "place",
variables = c("B01003_001", "B02001_003", "B19013_001"),
year = 2021,
state = "MS",
output = "wide")
# Step 4: General cleaning of census data to prepare for join with hometowns/roster data. This part is the same for every state and (except for the dataframe name) can more or less be copied and pasted.
census_data_ms_2021 <- census_data_ms_2021 %>%
clean_names() %>%
separate(name, into = c("city", "state"), sep = ", ", remove = FALSE) %>%
mutate(city = gsub("\\b(town|city|CDP|village)\\b", "", city)) %>%
mutate(city = str_squish(city)) %>%
select(geoid, city, state, b01003_001e, b02001_003e, b19013_001e) %>%
rename(total_pop = b01003_001e, black_pop = b02001_003e, median_income = b19013_001e) %>%
mutate(pct_black = round(black_pop/total_pop*100, 1))
# Step 5: State-specific cleaning of census data to prepare for join with hometowns/roster data. This part is different for every state. The first mutate function should be included for every state, just modified depending on the state name. Additional mutate functions may be needed for instances when the census names something in a weird way that doesn't line up with the hometowns.
census_data_ms_2021 <- census_data_ms_2021 %>%
mutate(state = case_when(
state == 'Mississippi' ~ "MS"))
# Step 6: Join the census data to the list of hometowns. Also create a column that tells us how many people are elite college football players for every 1,000 residents.
hometowns_ms_complete <- distinct_hometowns_ms %>%
left_join(census_data_ms_2021, by = c("hometown_city_clean" = "city", "hometown_state_clean" = "state")) %>%
mutate(players_per_thousand = round((total_players*1000)/total_pop,1)) %>%
arrange(desc(players_per_thousand))
# Step 7: Notice there are a few NA values. This happens when the census data does not join with the hometowns data, perhaps because the hometown is misspelled or because there is no census data for that town. First, let's find the NA values.
hometowns_ms_complete %>%
filter(is.na(geoid))
# Step 8: Now we have to figure out how to address each of the NA values. This is a judgment call, and we should be careful about documenting how and why we made that decision. If there is an NA value because a hometown is misspelled, tell Sapna, and she will make that correction in Open Refine. If there is an NA value because the census does not recognize the hometown, we need to find some substitute for that hometown.
# For Nesbit, MS, the zip code (38651) seems to be a good substitute: https://censusreporter.org/profiles/86000US38651-38651/
census_data_nesbit_ms_2021 <- get_acs(geography = "zcta",
variables = c("B01003_001", "B02001_003", "B19013_001"),
year = 2021,
output = "wide") %>%
clean_names() %>%
filter(name == "ZCTA5 38651") %>%
rename(city = name, total_pop = b01003_001e, black_pop = b02001_003e, median_income = b19013_001e) %>%
mutate(pct_black = round(black_pop/total_pop*100, 1)) %>%
mutate(state = "MS") %>%
mutate(city = case_when(
city == "ZCTA5 38651" ~ "Nesbit")) %>%
select(geoid, city, state, total_pop, black_pop, median_income, pct_black)
# For Friendship, MS data obtained using population of nearby Collins, MS, where the player went to HS https://censusreporter.org/profiles/16000US2815140-collins-ms/
census_data_friendship_ms_2021 <- get_acs(geography = "place",
variables = c("B01003_001", "B02001_003", "B19013_001"),
year = 2021,
state = "MS",
output = "wide") %>%
clean_names() %>%
filter(name == "Collins city, Mississippi") %>%
rename(city = name, total_pop = b01003_001e, black_pop = b02001_003e, median_income = b19013_001e) %>%
mutate(pct_black = round(black_pop/total_pop*100, 1)) %>%
mutate(state = "MS") %>%
mutate(city = case_when(
city == "Collins city, Mississippi" ~ "Friendship")) %>%
select(geoid, city, state, total_pop, black_pop, median_income, pct_black)
# Step 9: We now have to append these special cases to our state census data, redo the join, and run one more check for NA values.
census_data_ms_2021 <- bind_rows(census_data_ms_2021, census_data_nesbit_ms_2021, census_data_friendship_ms_2021)
hometowns_ms_complete <- distinct_hometowns_ms %>%
left_join(census_data_ms_2021, by = c("hometown_city_clean" = "city", "hometown_state_clean" = "state")) %>%
mutate(players_per_thousand = round((total_players*1000)/total_pop,1)) %>%
arrange(desc(players_per_thousand))
hometowns_ms_complete %>%
filter(is.na(geoid)) #If this is not producing an empty dataframe, go back and continue to work on NA values
# Step 10: If needed, uncomment out to create a CSV
#write_csv(hometowns_ms_complete, file = "hometowns_ms.csv")
View(hometowns_ms_complete)
