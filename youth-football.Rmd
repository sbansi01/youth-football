---
title: "Youth Football Data Analysis"
output: html_notebook
---

```{r}
#libraries
library(tidyverse)
library(googlesheets4)
library(janitor)
#library(tidycensus)
#library(lubridate)
#install.packages("googlesheets4")
#install.packages("ipumsr")
#library(ipumsr)

#Authenticating with Google account
#gs4_auth()

```

```{r}

#Load Aspen Institute participation rate data

age_6_12 <- read_sheet("https://docs.google.com/spreadsheets/d/1AvA8phsRgDh9AXj0sMeH1zZQtjJP9JD-8A2AH9YrBzY/edit#gid=0", sheet = "Ages 6-12")

age_13_17 <- read_sheet("https://docs.google.com/spreadsheets/d/1AvA8phsRgDh9AXj0sMeH1zZQtjJP9JD-8A2AH9YrBzY/edit#gid=0", sheet = "Ages 13-17") 

```

```{r}

# Load Census API key

Sys.setenv(CENSUS_API_KEY = "5cb2b9c628a1d1329c5bf4d36fe4435c6501efc8", overwrite = TRUE)

```

```{r}

#Reference tables

#Load ACS crosswalk

ACS_2021 <- load_variables(2021, "acs5")
ACS_2018 <- load_variables(2018, "acs5")
ACS_2013 <- load_variables(2018, "acs5")
ACS_2010 <- load_variables(2010, "acs5")
ACS_2009 <- load_variables(2009, "acs5")
ACS_2008 <- load_variables(2008, "acs3")
ACS_2007 <- load_variables(2007, "acs3")

#md_cities <- get_acs(geography = "place",
              #variables = c(medi_house_income = "B19013_001"),
              #state = "MD")

```

```{r}
# CODE BLOCKS FOR STATE
## Notes:
## labor_ variables are for age 16+
## education_ variables are for age 25+
## rent variables are median gross rent

#2007
#04/30 update: revised codes for education based on https://api.census.gov/data/2007/acs/acs3/variables.html

md_2007 <- get_acs(geography = "state",
                variables = c(medi_house_income = "B19013_001", 
                            population = "B01003_001", 
                            medi_home_value = "B25077_001", 
                            housing_total = "B25002_001",
                            housing_occupied = "B25002_002",
                            housing_vacancies = "B25002_003", 
                            #labor_total = "B23025_003", 
                            #labor_employed = "B23025_004", 
                            #labor_unemployed = "B23025_005",
                            education_total = "B06009_001",
                            education_hs = "B06009_003",
                            education_bachelors = "B06009_005",
                            public_assistance_total = "B22003_001",
                            public_assistance_received = "B22003_002",
                            public_assistance_not_received = "B22003_005",
                            #poverty_total = "B17020_001",
                            #poverty_below = "B17020_002",
                            #poverty_above = "B17020_010",
                            rent = "B25064_001",
                            real_estate_tax_median = "B25103_001"),
                            #real_estate_tax_aggregate = "B25090_001"),       
              survey = "acs3",
              state = "MD",
              year = 2007) %>% 
  mutate(year = 2007)

#2013
md_2013 <- get_acs(geography = "state",
                variables = c(medi_house_income = "B19013_001", 
                            population = "B01003_001", 
                            medi_home_value = "B25077_001", 
                            housing_total = "B25002_001",
                            housing_occupied = "B25002_002",
                            housing_vacancies = "B25002_003", 
                            labor_total = "B23025_003",
                            labor_employed = "B23025_004", 
                            labor_unemployed = "B23025_005",
                            education_total = "B15003_001",
                            education_hs = "B15003_017",
                            education_bachelors = "B15003_022",
                            public_assistance_total = "B22003_001",
                            public_assistance_received = "B22003_002",
                            public_assistance_not_received = "B22003_005",
                            poverty_total = "B17020_001",
                            poverty_below = "B17020_002",
                            poverty_above = "B17020_010",
                            rent = "B25064_001",
                            real_estate_tax_median = "B25103_001",
                            real_estate_tax_aggregate = "B25090_001"),        
              state = "MD",
              year = 2013) %>% 
  mutate(year = 2013)

#2018
md_2018 <- get_acs(geography = "state",
                variables = c(medi_house_income = "B19013_001", 
                            population = "B01003_001", 
                            medi_home_value = "B25077_001", 
                            housing_total = "B25002_001",
                            housing_occupied = "B25002_002",
                            housing_vacancies = "B25002_003", 
                            labor_total = "B23025_003", 
                            labor_employed = "B23025_004", 
                            labor_unemployed = "B23025_005",
                            education_total = "B15003_001",
                            education_hs = "B15003_017",
                            education_bachelors = "B15003_022",
                            public_assistance_total = "B22003_001",
                            public_assistance_received = "B22003_002",
                            public_assistance_not_received = "B22003_005",
                            poverty_total = "B17020_001",
                            poverty_below = "B17020_002",
                            poverty_above = "B17020_010",
                            rent = "B25064_001",
                            real_estate_tax_median = "B25103_001",
                            real_estate_tax_aggregate = "B25090_001"),        
              state = "MD",
              year = 2018) %>% 
  mutate(year = 2018)


```


```{r}
#CODE BLOCKS FOR COUNTY

#2007
#04/30 update: revised codes for education based on https://api.census.gov/data/2007/acs/acs3/variables.html
charles_2007 <- get_acs(geography = "county",
                variables = c(medi_house_income = "B19013_001", 
                            population = "B01003_001", 
                            medi_home_value = "B25077_001", 
                            housing_total = "B25002_001",
                            housing_occupied = "B25002_002",
                            housing_vacancies = "B25002_003", 
                            #labor_total = "B23025_003", 
                            #labor_employed = "B23025_004", 
                            #labor_unemployed = "B23025_005",
                            education_total = "B06009_001",
                            education_hs = "B06009_003",
                            education_bachelors = "B06009_005",
                            public_assistance_total = "B22003_001",
                            public_assistance_received = "B22003_002",
                            public_assistance_not_received = "B22003_005",
                            #poverty_total = "B17020_001",
                            #poverty_below = "B17020_002",
                            #poverty_above = "B17020_010",
                            rent = "B25064_001",
                            real_estate_tax_median = "B25103_001"),
                            #real_estate_tax_aggregate = "B25090_001"),
              survey = "acs3",
              state = "MD",
              year = 2007) %>% 
  filter(NAME == "Charles County, Maryland") %>% 
  mutate(year = 2007)


#2013
charles_2013 <- get_acs(geography = "county",
                variables = c(medi_house_income = "B19013_001", 
                            population = "B01003_001", 
                            medi_home_value = "B25077_001", 
                            housing_total = "B25002_001",
                            housing_occupied = "B25002_002",
                            housing_vacancies = "B25002_003", 
                            labor_total = "B23025_003", 
                            labor_employed = "B23025_004", 
                            labor_unemployed = "B23025_005",
                            education_total = "B15003_001",
                            education_hs = "B15003_017",
                            education_bachelors = "B15003_022",
                            public_assistance_total = "B22003_001",
                            public_assistance_received = "B22003_002",
                            public_assistance_not_received = "B22003_005",
                            poverty_total = "B17020_001",
                            poverty_below = "B17020_002",
                            poverty_above = "B17020_010",
                            rent = "B25064_001",
                            real_estate_tax_median = "B25103_001",
                            real_estate_tax_aggregate = "B25090_001"),              
              state = "MD",
              year = 2013) %>% 
  filter(NAME == "Charles County, Maryland") %>% 
  mutate(year = 2013)

#2018
charles_2018 <- get_acs(geography = "county",
                variables = c(medi_house_income = "B19013_001", 
                            population = "B01003_001", 
                            medi_home_value = "B25077_001", 
                            housing_total = "B25002_001",
                            housing_occupied = "B25002_002",
                            housing_vacancies = "B25002_003", 
                            labor_total = "B23025_003", 
                            labor_employed = "B23025_004", 
                            labor_unemployed = "B23025_005",
                            education_total = "B15003_001",
                            education_hs = "B15003_017",
                            education_bachelors = "B15003_022",
                            public_assistance_total = "B22003_001",
                            public_assistance_received = "B22003_002",
                            public_assistance_not_received = "B22003_005",
                            poverty_total = "B17020_001",
                            poverty_below = "B17020_002",
                            poverty_above = "B17020_010",
                            rent = "B25064_001",
                            real_estate_tax_median = "B25103_001",
                            real_estate_tax_aggregate = "B25090_001"),              
              state = "MD",
              year = 2018) %>% 
  filter(NAME == "Charles County, Maryland") %>% 
  mutate(year = 2018)

```


```{r}

#CODE BLOCKS FOR CITY

#2007
#04/30 update: revised codes for education based on https://api.census.gov/data/2007/acs/acs3/variables.html
w_2007 <- get_acs(geography = "place",
                variables = c(medi_house_income = "B19013_001", 
                            population = "B01003_001", 
                            medi_home_value = "B25077_001", 
                            housing_total = "B25002_001",
                            housing_occupied = "B25002_002",
                            housing_vacancies = "B25002_003", 
                            #labor_total = "B23025_003", 
                            #labor_employed = "B23025_004", 
                            #labor_unemployed = "B23025_005",
                            education_total = "B06009_001",
                            education_hs = "B06009_003",
                            education_bachelors = "B06009_005",
                            public_assistance_total = "B22003_001",
                            public_assistance_received = "B22003_002",
                            public_assistance_not_received = "B22003_005",
                            #poverty_total = "B17020_001",
                            #poverty_below = "B17020_002",
                            #poverty_above = "B17020_010",
                            rent = "B25064_001",
                            real_estate_tax_median = "B25103_001"),
                            #real_estate_tax_aggregate = "B25090_001"),        
              survey = "acs3",
              state = "MD",
              year = 2007) %>% 
  filter(NAME == "Waldorf CDP, Maryland") %>% 
  mutate(year = 2007)

#2013
w_2013 <- get_acs(geography = "place",
                variables = c(medi_house_income = "B19013_001", 
                            population = "B01003_001", 
                            medi_home_value = "B25077_001", 
                            housing_total = "B25002_001",
                            housing_occupied = "B25002_002",
                            housing_vacancies = "B25002_003", 
                            labor_total = "B23025_003", 
                            labor_employed = "B23025_004", 
                            labor_unemployed = "B23025_005",
                            education_total = "B15003_001",
                            education_hs = "B15003_017",
                            education_bachelors = "B15003_022",
                            public_assistance_total = "B22003_001",
                            public_assistance_received = "B22003_002",
                            public_assistance_not_received = "B22003_005",
                            poverty_total = "B17020_001",
                            poverty_below = "B17020_002",
                            poverty_above = "B17020_010",
                            rent = "B25064_001",
                            real_estate_tax_median = "B25103_001",
                            real_estate_tax_aggregate = "B25090_001"),        
              state = "MD",
              year = 2013) %>% 
  filter(NAME == "Waldorf CDP, Maryland") %>% 
  mutate(year = 2013)

#2018
w_2018 <- get_acs(geography = "place",
                variables = c(medi_house_income = "B19013_001", 
                            population = "B01003_001", 
                            medi_home_value = "B25077_001", 
                            housing_total = "B25002_001",
                            housing_occupied = "B25002_002",
                            housing_vacancies = "B25002_003", 
                            labor_total = "B23025_003", 
                            labor_employed = "B23025_004", 
                            labor_unemployed = "B23025_005",
                            education_total = "B15003_001",
                            education_hs = "B15003_017",
                            education_bachelors = "B15003_022",
                            public_assistance_total = "B22003_001",
                            public_assistance_received = "B22003_002",
                            public_assistance_not_received = "B22003_005",
                            poverty_total = "B17020_001",
                            poverty_below = "B17020_002",
                            poverty_above = "B17020_010",
                            rent = "B25064_001",
                            real_estate_tax_median = "B25103_001",
                            real_estate_tax_aggregate = "B25090_001"),        
              state = "MD",
              year = 2018) %>% 
  filter(NAME == "Waldorf CDP, Maryland") %>% 
  mutate(year = 2018)

```

```{r}
#CODE BLOCKS FOR ZIP CODES
# Waldorf Zip is 20602
# We may have to reconsider this. ACS data does not seem to be available at zip code level until 2011. Might experiment with other small geographies like census tracts or school districts.

#2007
# May not be possible because ACS3 not available for ZCTA. Must use ACS5 or decennial census.

#2008
# May not be possible because ACS3 not available for ZCTA. Must use ACS5 or decennial census.

#2009
# May not be possible because ACS5 not available for ZCTA. Must use ACS5 from 2011 or 2010 decennial census.

#2013
zip_2013 <- get_acs(geography = "zip code tabulation area",
                variables = c(medi_house_income = "B19013_001", 
                            population = "B01003_001", 
                            medi_home_value = "B25077_001", 
                            housing_total = "B25002_001",
                            housing_occupied = "B25002_002",
                            housing_vacancies = "B25002_003", 
                            labor_total = "B23025_003", 
                            labor_employed = "B23025_004", 
                            labor_unemployed = "B23025_005",
                            education_total = "B15003_001",
                            education_hs = "B15003_017",
                            education_bachelors = "B15003_022",
                            public_assistance_total = "B22003_001",
                            public_assistance_received = "B22003_002",
                            public_assistance_not_received = "B22003_005",
                            poverty_total = "B17020_001",
                            poverty_below = "B17020_002",
                            poverty_above = "B17020_010",
                            rent = "B25064_001",
                            real_estate_tax_median = "B25103_001",
                            real_estate_tax_aggregate = "B25090_001"),
              state = "MD",
              year = 2013) %>%
              filter(GEOID == "20602") %>% 
  mutate(year = 2013)

#2018
zip_2018 <- get_acs(geography = "zip code tabulation area",
                variables = c(medi_house_income = "B19013_001", 
                            population = "B01003_001", 
                            medi_home_value = "B25077_001", 
                            housing_total = "B25002_001",
                            housing_occupied = "B25002_002",
                            housing_vacancies = "B25002_003", 
                            labor_total = "B23025_003", 
                            labor_employed = "B23025_004", 
                            labor_unemployed = "B23025_005",
                            education_total = "B15003_001",
                            education_hs = "B15003_017",
                            education_bachelors = "B15003_022",
                            public_assistance_total = "B22003_001",
                            public_assistance_received = "B22003_002",
                            public_assistance_not_received = "B22003_005",
                            poverty_total = "B17020_001",
                            poverty_below = "B17020_002",
                            poverty_above = "B17020_010",
                            rent = "B25064_001",
                            real_estate_tax_median = "B25103_001",
                            real_estate_tax_aggregate = "B25090_001"),
              state = "MD",
              year = 2018) %>%
              filter(GEOID == "20602") %>% 
  mutate(year = 2018)


```


```{r}

#TRYING TO FIGURE OUT A ZIP CODE ALTERNATIVE

# School district? Won't work because MD school districts are just counties
mdschools_2018 <- get_acs(geography = "school district (unified)",
                variables = c(medi_house_income = "B19013_001"),
              state = "MD",
              year = 2018) %>% 
  mutate(year = 2018)

# Tracts? Available for 09 ACS5 (in addition to 13 and 18)
# This seems to have potential if we can figure out what census tract the stadium is in
# To figure out census tract, put in address of nearby high school into this search: https://geocoding.geo.census.gov/geocoder/geographies/address?street=5305%20Piney%20Church%20Rd&city=Waldorf&state=Maryland&zip=20602&benchmark=4&vintage=4 - says census tract is 8509.04 for 2020 and 2010
# Charles County census tracts map: https://www.charlescountymd.gov/home/showpublishedimage/3143/637679134245270000

mdtracts_2009 <- get_acs(geography = "tract",
                variables = c(medi_house_income = "B19013_001"),
              state = "MD",
              year = 2009) %>% 
  mutate(year = 2009)

mdtracts_2013 <- get_acs(geography = "tract",
                variables = c(medi_house_income = "B19013_001"),
              state = "MD",
              year = 2013) %>% 
  mutate(year = 2013)

mdtracts_2018 <- get_acs(geography = "tract",
                variables = c(medi_house_income = "B19013_001"),
              state = "MD",
              year = 2018) %>% 
  mutate(year = 2018)


```

```{r}

#CODE BLOCKS FOR CENSUS TRACT
#Census tract = 8509.04

#2009 (unable to use 2007 because tract-level data not available for ACS3)
#04/30 update: revised codes for education based on https://api.census.gov/data/2009/acs/acs5/variables.html
# Using age 25+ for consistency with other education variables
tract_2009 <- get_acs(geography = "tract",
                variables = c(medi_house_income = "B19013_001", 
                            population = "B01003_001", 
                            medi_home_value = "B25077_001", 
                            housing_total = "B25002_001",
                            housing_occupied = "B25002_002",
                            housing_vacancies = "B25002_003", 
                            #labor_total = "B23025_003", 
                            #labor_employed = "B23025_004", 
                            #labor_unemployed = "B23025_005",
                            education_total = "B15002_001",
                            education_men_total = "B15002_002",
                            education_men_hs = "B15002_011",
                            education_men_bachelors = "B15002_015",
                            education_women_total = "B15002_019",
                            education_women_hs = "B15002_028",
                            education_women_bachelors = "B15002_032",
                            #public_assistance_total = "B22003_001",
                            #public_assistance_received = "B22003_002",
                            #public_assistance_not_received = "B22003_005",
                            #poverty_total = "B17020_001",
                            #poverty_below = "B17020_002",
                            #poverty_above = "B17020_010",
                            rent = "B25064_001"),
                            #real_estate_tax_median = "B25103_001",
                            #real_estate_tax_aggregate = "B25090_001",
              state = "MD",
              year = 2009) %>% 
  filter(NAME == "Census Tract 8509.04, Charles County, Maryland") %>%
  mutate(year = 2009)

#2013
tract_2013 <- get_acs(geography = "tract",
                variables = c(medi_house_income = "B19013_001", 
                            population = "B01003_001", 
                            medi_home_value = "B25077_001", 
                            housing_total = "B25002_001",
                            housing_occupied = "B25002_002",
                            housing_vacancies = "B25002_003", 
                            labor_total = "B23025_003", 
                            labor_employed = "B23025_004", 
                            labor_unemployed = "B23025_005",
                            education_total = "B15003_001",
                            education_hs = "B15003_017",
                            education_bachelors = "B15003_022",
                            public_assistance_total = "B22003_001",
                            public_assistance_received = "B22003_002",
                            public_assistance_not_received = "B22003_005",
                            poverty_total = "B17020_001",
                            poverty_below = "B17020_002",
                            poverty_above = "B17020_010",
                            rent = "B25064_001",
                            real_estate_tax_median = "B25103_001",
                            real_estate_tax_aggregate = "B25090_001"),        
              state = "MD",
              year = 2013) %>% 
  filter(NAME == "Census Tract 8509.04, Charles County, Maryland") %>% 
  mutate(year = 2013)

#2018
tract_2018 <- get_acs(geography = "tract",
                variables = c(medi_house_income = "B19013_001", 
                            population = "B01003_001", 
                            medi_home_value = "B25077_001", 
                            housing_total = "B25002_001",
                            housing_occupied = "B25002_002",
                            housing_vacancies = "B25002_003", 
                            labor_total = "B23025_003", 
                            labor_employed = "B23025_004", 
                            labor_unemployed = "B23025_005",
                            education_total = "B15003_001",
                            education_hs = "B15003_017",
                            education_bachelors = "B15003_022",
                            public_assistance_total = "B22003_001",
                            public_assistance_received = "B22003_002",
                            public_assistance_not_received = "B22003_005",
                            poverty_total = "B17020_001",
                            poverty_below = "B17020_002",
                            poverty_above = "B17020_010",
                            rent = "B25064_001",
                            real_estate_tax_median = "B25103_001",
                            real_estate_tax_aggregate = "B25090_001"),        
              state = "MD",
              year = 2018) %>% 
  filter(NAME == "Census Tract 8509.04, Charles County, Maryland") %>% 
  mutate(year = 2018)

```

```{r}

# UPDATE 06/07: TRYING TO FIND ANOTHER WALDORF/CHARLES COUNTY CENSUS TRACT FOR COMPARISON

# Remember that the stadium has a Waldorf zip code but is actually situated in the planned community of St. Charles

# Taking a look at POPULATION, INCOME, and RENT of census tracts that bordered the stadium census tract (8509.04) as of 2008
# Source: 2000 Charles County census tract map https://planning.maryland.gov/MSDC/Documents/census/cen2000/maps/ct00/charct00.pdf

charlestracts_pop_2009 <- get_acs(geography = "tract",
                                 variables = c(population = "B01003_001"),
                                 state = "MD",
                                 year = 2009) %>%
  filter(NAME %in% c("Census Tract 8509.04, Charles County, Maryland",
                     "Census Tract 8510.02, Charles County, Maryland",
                     "Census Tract 8509.02, Charles County, Maryland",
                     "Census Tract 8509.06, Charles County, Maryland",
                     "Census Tract 8509.05, Charles County, Maryland",
                     "Census Tract 8508.02, Charles County, Maryland",
                     "Census Tract 8513, Charles County, Maryland")) %>%
  mutate(year = 2009) %>%
  arrange(desc(estimate)) %>%
  mutate(comp_to_stadium = round(estimate*100/first(estimate[NAME == "Census Tract 8509.04, Charles County, Maryland"]),1))

charlestracts_income_2009 <- get_acs(geography = "tract",
                             variables = c(medi_house_income = "B19013_001"),
                             state = "MD",
                             year = 2009) %>%
  filter(NAME == "Census Tract 8509.04, Charles County, Maryland" | NAME == "Census Tract 8510.02, Charles County, Maryland" | NAME == "Census Tract 8509.02, Charles County, Maryland" | NAME == "Census Tract 8509.06, Charles County, Maryland" | NAME == "Census Tract 8509.05, Charles County, Maryland" | NAME == "Census Tract 8508.02, Charles County, Maryland" | NAME == "Census Tract 8513, Charles County, Maryland") %>% 
  mutate(year = 2009) %>%
  arrange(desc(estimate)) %>%
    mutate(comp_to_stadium = round(estimate*100/first(estimate[NAME == "Census Tract 8509.04, Charles County, Maryland"]),1))

charlestracts_rent_2009 <- get_acs(geography = "tract",
                             variables = c(rent = "B25064_001"),
                             state = "MD",
                             year = 2009) %>%
  filter(NAME == "Census Tract 8509.04, Charles County, Maryland" | NAME == "Census Tract 8510.02, Charles County, Maryland" | NAME == "Census Tract 8509.02, Charles County, Maryland" | NAME == "Census Tract 8509.06, Charles County, Maryland" | NAME == "Census Tract 8509.05, Charles County, Maryland" | NAME == "Census Tract 8508.02, Charles County, Maryland" | NAME == "Census Tract 8513, Charles County, Maryland") %>% 
  mutate(year = 2009) %>%
  arrange(desc(estimate)) %>%
    mutate(comp_to_stadium = round(estimate*100/first(estimate[NAME == "Census Tract 8509.04, Charles County, Maryland"]),1))

# Possibilities:
## 8509.05 - best match but might be too close to the stadium
## 8508.02 - good match on pop and rent, less good on income
## 8509.02 - good match on income and rent, less good on pop

```

```{r}

#UPDATE 06/08
#CODE BLOCKS FOR CENSUS TRACT COMPARISON
#Census tract = 8508.02

#2009 (unable to use 2007 because tract-level data not available for ACS3)
# Using age 25+ for consistency with other education variables
tractcomp_2009 <- get_acs(geography = "tract",
                variables = c(medi_house_income = "B19013_001", 
                            population = "B01003_001", 
                            medi_home_value = "B25077_001", 
                            housing_total = "B25002_001",
                            housing_occupied = "B25002_002",
                            housing_vacancies = "B25002_003", 
                            #labor_total = "B23025_003", 
                            #labor_employed = "B23025_004", 
                            #labor_unemployed = "B23025_005",
                            education_total = "B15002_001",
                            education_men_total = "B15002_002",
                            education_men_hs = "B15002_011",
                            education_men_bachelors = "B15002_015",
                            education_women_total = "B15002_019",
                            education_women_hs = "B15002_028",
                            education_women_bachelors = "B15002_032",
                            #public_assistance_total = "B22003_001",
                            #public_assistance_received = "B22003_002",
                            #public_assistance_not_received = "B22003_005",
                            #poverty_total = "B17020_001",
                            #poverty_below = "B17020_002",
                            #poverty_above = "B17020_010",
                            rent = "B25064_001"),
                            #real_estate_tax_median = "B25103_001",
                            #real_estate_tax_aggregate = "B25090_001",
              state = "MD",
              year = 2009) %>% 
  filter(NAME == "Census Tract 8508.02, Charles County, Maryland") %>%
  mutate(year = 2009)

#2013
tractcomp_2013 <- get_acs(geography = "tract",
                variables = c(medi_house_income = "B19013_001", 
                            population = "B01003_001", 
                            medi_home_value = "B25077_001", 
                            housing_total = "B25002_001",
                            housing_occupied = "B25002_002",
                            housing_vacancies = "B25002_003", 
                            labor_total = "B23025_003", 
                            labor_employed = "B23025_004", 
                            labor_unemployed = "B23025_005",
                            education_total = "B15003_001",
                            education_hs = "B15003_017",
                            education_bachelors = "B15003_022",
                            public_assistance_total = "B22003_001",
                            public_assistance_received = "B22003_002",
                            public_assistance_not_received = "B22003_005",
                            poverty_total = "B17020_001",
                            poverty_below = "B17020_002",
                            poverty_above = "B17020_010",
                            rent = "B25064_001",
                            real_estate_tax_median = "B25103_001",
                            real_estate_tax_aggregate = "B25090_001"),        
              state = "MD",
              year = 2013) %>% 
  filter(NAME == "Census Tract 8508.02, Charles County, Maryland") %>% 
  mutate(year = 2013)

#2018
tractcomp_2018 <- get_acs(geography = "tract",
                variables = c(medi_house_income = "B19013_001", 
                            population = "B01003_001", 
                            medi_home_value = "B25077_001", 
                            housing_total = "B25002_001",
                            housing_occupied = "B25002_002",
                            housing_vacancies = "B25002_003", 
                            labor_total = "B23025_003", 
                            labor_employed = "B23025_004", 
                            labor_unemployed = "B23025_005",
                            education_total = "B15003_001",
                            education_hs = "B15003_017",
                            education_bachelors = "B15003_022",
                            public_assistance_total = "B22003_001",
                            public_assistance_received = "B22003_002",
                            public_assistance_not_received = "B22003_005",
                            poverty_total = "B17020_001",
                            poverty_below = "B17020_002",
                            poverty_above = "B17020_010",
                            rent = "B25064_001",
                            real_estate_tax_median = "B25103_001",
                            real_estate_tax_aggregate = "B25090_001"),        
              state = "MD",
              year = 2018) %>% 
  filter(NAME == "Census Tract 8508.02, Charles County, Maryland") %>% 
  mutate(year = 2018)

```

#START OF PREPPING OUTPUT FOR ABBI


```{r}

#RENT

#STATE
# Note: starting point here is ACS3 2007
mdrent_2008 <- md_2007 %>%
  filter(variable == "rent") %>%
  select(year, estimate)

mdrent_2013 <- md_2013 %>%
  filter(variable == "rent") %>%
  select(year, estimate)

mdrent_2018 <- md_2018 %>%
  filter(variable == "rent") %>%
  select(year, estimate)

mdrent <- bind_rows(mdrent_2008, mdrent_2013, mdrent_2018) %>%
  spread(key = year, value = estimate) %>%
  rename("year_2008" = "2007") %>%
  rename("year_2013" = "2013") %>%
  rename("year_2018" = "2018") %>%
  mutate(location = "Maryland") %>%
  mutate(variable = "median gross rent") %>%
  mutate(pct_change_5 = round((year_2013-year_2008)/year_2008*100,1)) %>%
  mutate(pct_change_10 = round((year_2018-year_2008)/year_2008*100,1)) %>%
  mutate(pct_change_5_to_10 = round((year_2018-year_2013)/year_2013*100,1)) %>%
  select(variable, location, year_2008:year_2018, pct_change_5:pct_change_5_to_10)

#COUNTY
# Note: starting point here is ACS3 2007
charlesrent_2008 <- charles_2007 %>%
  filter(variable == "rent") %>%
  select(year, estimate)

charlesrent_2013 <- charles_2013 %>%
  filter(variable == "rent") %>%
  select(year, estimate)

charlesrent_2018 <- charles_2018 %>%
  filter(variable == "rent") %>%
  select(year, estimate)

charlesrent <- bind_rows(charlesrent_2008, charlesrent_2013, charlesrent_2018) %>%
  spread(key = year, value = estimate) %>%
  rename("year_2008" = "2007") %>%
  rename("year_2013" = "2013") %>%
  rename("year_2018" = "2018") %>%
  mutate(location = "Charles County") %>%
  mutate(variable = "median gross rent") %>%
  mutate(pct_change_5 = round((year_2013-year_2008)/year_2008*100,1)) %>%
  mutate(pct_change_10 = round((year_2018-year_2008)/year_2008*100,1)) %>%
  mutate(pct_change_5_to_10 = round((year_2018-year_2013)/year_2013*100,1)) %>%
  select(variable, location, year_2008:year_2018, pct_change_5:pct_change_5_to_10)

#CITY
# Note: starting point here is ACS3 2007
wrent_2008 <- w_2007 %>%
  filter(variable == "rent") %>%
  select(year, estimate)

wrent_2013 <- w_2013 %>%
  filter(variable == "rent") %>%
  select(year, estimate)

wrent_2018 <- w_2018 %>%
  filter(variable == "rent") %>%
  select(year, estimate)

wrent <- bind_rows(wrent_2008, wrent_2013, wrent_2018) %>%
  spread(key = year, value = estimate) %>%
  rename("year_2008" = "2007") %>%
  rename("year_2013" = "2013") %>%
  rename("year_2018" = "2018") %>%
  mutate(location = "Waldorf") %>%
  mutate(variable = "median gross rent") %>%
  mutate(pct_change_5 = round((year_2013-year_2008)/year_2008*100,1)) %>%
  mutate(pct_change_10 = round((year_2018-year_2008)/year_2008*100,1)) %>%
  mutate(pct_change_5_to_10 = round((year_2018-year_2013)/year_2013*100,1)) %>%
  select(variable, location, year_2008:year_2018, pct_change_5:pct_change_5_to_10)

#TRACT
# Note: starting point here is ACS5 2009
tractrent_2008 <- tract_2009 %>%
  filter(variable == "rent") %>%
  select(year, estimate)

tractrent_2013 <- tract_2013 %>%
  filter(variable == "rent") %>%
  select(year, estimate)

tractrent_2018 <- tract_2018 %>%
  filter(variable == "rent") %>%
  select(year, estimate)

tractrent <- bind_rows(tractrent_2008, tractrent_2013, tractrent_2018) %>%
  spread(key = year, value = estimate) %>%
  rename("year_2008" = "2009") %>%
  rename("year_2013" = "2013") %>%
  rename("year_2018" = "2018") %>%
  mutate(location = "Census Tract 8509.04") %>%
  mutate(variable = "median gross rent") %>%
  mutate(pct_change_5 = round((year_2013-year_2008)/year_2008*100,1)) %>%
  mutate(pct_change_10 = round((year_2018-year_2008)/year_2008*100,1)) %>%
  mutate(pct_change_5_to_10 = round((year_2018-year_2013)/year_2013*100,1)) %>%
  select(variable, location, year_2008:year_2018, pct_change_5:pct_change_5_to_10)

#TRACT COMP
# Note: starting point here is ACS5 2009
tractcomprent_2008 <- tractcomp_2009 %>%
  filter(variable == "rent") %>%
  select(year, estimate)

tractcomprent_2013 <- tractcomp_2013 %>%
  filter(variable == "rent") %>%
  select(year, estimate)

tractcomprent_2018 <- tractcomp_2018 %>%
  filter(variable == "rent") %>%
  select(year, estimate)

tractcomprent <- bind_rows(tractcomprent_2008, tractcomprent_2013, tractcomprent_2018) %>%
  spread(key = year, value = estimate) %>%
  rename("year_2008" = "2009") %>%
  rename("year_2013" = "2013") %>%
  rename("year_2018" = "2018") %>%
  mutate(location = "Census Tract 8508.02_comparison") %>%
  mutate(variable = "median gross rent") %>%
  mutate(pct_change_5 = round((year_2013-year_2008)/year_2008*100,1)) %>%
  mutate(pct_change_10 = round((year_2018-year_2008)/year_2008*100,1)) %>%
  mutate(pct_change_5_to_10 = round((year_2018-year_2013)/year_2013*100,1)) %>%
  select(variable, location, year_2008:year_2018, pct_change_5:pct_change_5_to_10)

# ALL TOGETHER
rent <- bind_rows(mdrent, charlesrent, wrent, tractrent, tractcomprent)

# CSV
write_csv(rent, file = "rent.csv")

```


```{r}

#POPULATION

#STATE
# Note: starting point here is ACS3 2007
mdpop_2008 <- md_2007 %>%
  filter(variable == "population") %>%
  select(year, estimate)

mdpop_2013 <- md_2013 %>%
  filter(variable == "population") %>%
  select(year, estimate)

mdpop_2018 <- md_2018 %>%
  filter(variable == "population") %>%
  select(year, estimate)

mdpop <- bind_rows(mdpop_2008, mdpop_2013, mdpop_2018) %>%
  spread(key = year, value = estimate) %>%
  rename("year_2008" = "2007") %>%
  rename("year_2013" = "2013") %>%
  rename("year_2018" = "2018") %>%
  mutate(location = "Maryland") %>%
  mutate(variable = "total population") %>%
  mutate(pct_change_5 = round((year_2013-year_2008)/year_2008*100,1)) %>%
  mutate(pct_change_10 = round((year_2018-year_2008)/year_2008*100,1)) %>%
  mutate(pct_change_5_to_10 = round((year_2018-year_2013)/year_2013*100,1)) %>%
  select(variable, location, year_2008:year_2018, pct_change_5:pct_change_5_to_10)

#COUNTY
# Note: starting point here is ACS3 2007
charlespop_2008 <- charles_2007 %>%
  filter(variable == "population") %>%
  select(year, estimate)

charlespop_2013 <- charles_2013 %>%
  filter(variable == "population") %>%
  select(year, estimate)

charlespop_2018 <- charles_2018 %>%
  filter(variable == "population") %>%
  select(year, estimate)

charlespop <- bind_rows(charlespop_2008, charlespop_2013, charlespop_2018) %>%
  spread(key = year, value = estimate) %>%
  rename("year_2008" = "2007") %>%
  rename("year_2013" = "2013") %>%
  rename("year_2018" = "2018") %>%
  mutate(location = "Charles County") %>%
  mutate(variable = "total population") %>%
  mutate(pct_change_5 = round((year_2013-year_2008)/year_2008*100,1)) %>%
  mutate(pct_change_10 = round((year_2018-year_2008)/year_2008*100,1)) %>%
  mutate(pct_change_5_to_10 = round((year_2018-year_2013)/year_2013*100,1)) %>%
  select(variable, location, year_2008:year_2018, pct_change_5:pct_change_5_to_10)

#CITY
# Note: starting point here is ACS3 2007
wpop_2008 <- w_2007 %>%
  filter(variable == "population") %>%
  select(year, estimate)

wpop_2013 <- w_2013 %>%
  filter(variable == "population") %>%
  select(year, estimate)

wpop_2018 <- w_2018 %>%
  filter(variable == "population") %>%
  select(year, estimate)

wpop <- bind_rows(wpop_2008, wpop_2013, wpop_2018) %>%
  spread(key = year, value = estimate) %>%
  rename("year_2008" = "2007") %>%
  rename("year_2013" = "2013") %>%
  rename("year_2018" = "2018") %>%
  mutate(location = "Waldorf") %>%
  mutate(variable = "total population") %>%
  mutate(pct_change_5 = round((year_2013-year_2008)/year_2008*100,1)) %>%
  mutate(pct_change_10 = round((year_2018-year_2008)/year_2008*100,1)) %>%
  mutate(pct_change_5_to_10 = round((year_2018-year_2013)/year_2013*100,1)) %>%
  select(variable, location, year_2008:year_2018, pct_change_5:pct_change_5_to_10)

#TRACT
# Note: starting point here is ACS5 2009
tractpop_2008 <- tract_2009 %>%
  filter(variable == "population") %>%
  select(year, estimate)

tractpop_2013 <- tract_2013 %>%
  filter(variable == "population") %>%
  select(year, estimate)

tractpop_2018 <- tract_2018 %>%
  filter(variable == "population") %>%
  select(year, estimate)

tractpop <- bind_rows(tractpop_2008, tractpop_2013, tractpop_2018) %>%
  spread(key = year, value = estimate) %>%
  rename("year_2008" = "2009") %>%
  rename("year_2013" = "2013") %>%
  rename("year_2018" = "2018") %>%
  mutate(location = "Census Tract 8509.04") %>%
  mutate(variable = "total population") %>%
  mutate(pct_change_5 = round((year_2013-year_2008)/year_2008*100,1)) %>%
  mutate(pct_change_10 = round((year_2018-year_2008)/year_2008*100,1)) %>%
  mutate(pct_change_5_to_10 = round((year_2018-year_2013)/year_2013*100,1)) %>%
  select(variable, location, year_2008:year_2018, pct_change_5:pct_change_5_to_10)

#TRACT COMP
# Note: starting point here is ACS5 2009
tractcomppop_2008 <- tractcomp_2009 %>%
  filter(variable == "population") %>%
  select(year, estimate)

tractcomppop_2013 <- tractcomp_2013 %>%
  filter(variable == "population") %>%
  select(year, estimate)

tractcomppop_2018 <- tractcomp_2018 %>%
  filter(variable == "population") %>%
  select(year, estimate)

tractcomppop <- bind_rows(tractcomppop_2008, tractcomppop_2013, tractcomppop_2018) %>%
  spread(key = year, value = estimate) %>%
  rename("year_2008" = "2009") %>%
  rename("year_2013" = "2013") %>%
  rename("year_2018" = "2018") %>%
  mutate(location = "Census Tract 8508.02_comparison") %>%
  mutate(variable = "total population") %>%
  mutate(pct_change_5 = round((year_2013-year_2008)/year_2008*100,1)) %>%
  mutate(pct_change_10 = round((year_2018-year_2008)/year_2008*100,1)) %>%
  mutate(pct_change_5_to_10 = round((year_2018-year_2013)/year_2013*100,1)) %>%
  select(variable, location, year_2008:year_2018, pct_change_5:pct_change_5_to_10)

# ALL TOGETHER
population <- bind_rows(mdpop, charlespop, wpop, tractpop, tractcomppop)

# CSV
write_csv(population, file = "population.csv")

```


```{r}

#INCOME

#STATE
# Note: starting point here is ACS3 2007
mdincome_2008 <- md_2007 %>%
  filter(variable == "medi_house_income") %>%
  select(year, estimate)

mdincome_2013 <- md_2013 %>%
  filter(variable == "medi_house_income") %>%
  select(year, estimate)

mdincome_2018 <- md_2018 %>%
  filter(variable == "medi_house_income") %>%
  select(year, estimate)

mdincome <- bind_rows(mdincome_2008, mdincome_2013, mdincome_2018) %>%
  spread(key = year, value = estimate) %>%
  rename("year_2008" = "2007") %>%
  rename("year_2013" = "2013") %>%
  rename("year_2018" = "2018") %>%
  mutate(location = "Maryland") %>%
  mutate(variable = "median household income") %>%
  mutate(pct_change_5 = round((year_2013-year_2008)/year_2008*100,1)) %>%
  mutate(pct_change_10 = round((year_2018-year_2008)/year_2008*100,1)) %>%
  mutate(pct_change_5_to_10 = round((year_2018-year_2013)/year_2013*100,1)) %>%
  select(variable, location, year_2008:year_2018, pct_change_5:pct_change_5_to_10)

#COUNTY
# Note: starting point here is ACS3 2007
charlesincome_2008 <- charles_2007 %>%
  filter(variable == "medi_house_income") %>%
  select(year, estimate)

charlesincome_2013 <- charles_2013 %>%
  filter(variable == "medi_house_income") %>%
  select(year, estimate)

charlesincome_2018 <- charles_2018 %>%
  filter(variable == "medi_house_income") %>%
  select(year, estimate)

charlesincome <- bind_rows(charlesincome_2008, charlesincome_2013, charlesincome_2018) %>%
  spread(key = year, value = estimate) %>%
  rename("year_2008" = "2007") %>%
  rename("year_2013" = "2013") %>%
  rename("year_2018" = "2018") %>%
  mutate(location = "Charles County") %>%
  mutate(variable = "median household income") %>%
  mutate(pct_change_5 = round((year_2013-year_2008)/year_2008*100,1)) %>%
  mutate(pct_change_10 = round((year_2018-year_2008)/year_2008*100,1)) %>%
  mutate(pct_change_5_to_10 = round((year_2018-year_2013)/year_2013*100,1)) %>%
  select(variable, location, year_2008:year_2018, pct_change_5:pct_change_5_to_10)

#CITY
# Note: starting point here is ACS3 2007
wincome_2008 <- w_2007 %>%
  filter(variable == "medi_house_income") %>%
  select(year, estimate)

wincome_2013 <- w_2013 %>%
  filter(variable == "medi_house_income") %>%
  select(year, estimate)

wincome_2018 <- w_2018 %>%
  filter(variable == "medi_house_income") %>%
  select(year, estimate)

wincome <- bind_rows(wincome_2008, wincome_2013, wincome_2018) %>%
  spread(key = year, value = estimate) %>%
  rename("year_2008" = "2007") %>%
  rename("year_2013" = "2013") %>%
  rename("year_2018" = "2018") %>%
  mutate(location = "Waldorf") %>%
  mutate(variable = "median household income") %>%
  mutate(pct_change_5 = round((year_2013-year_2008)/year_2008*100,1)) %>%
  mutate(pct_change_10 = round((year_2018-year_2008)/year_2008*100,1)) %>%
  mutate(pct_change_5_to_10 = round((year_2018-year_2013)/year_2013*100,1)) %>%
  select(variable, location, year_2008:year_2018, pct_change_5:pct_change_5_to_10)

#TRACT
# Note: starting point here is ACS5 2009
tractincome_2008 <- tract_2009 %>%
  filter(variable == "medi_house_income") %>%
  select(year, estimate)

tractincome_2013 <- tract_2013 %>%
  filter(variable == "medi_house_income") %>%
  select(year, estimate)

tractincome_2018 <- tract_2018 %>%
  filter(variable == "medi_house_income") %>%
  select(year, estimate)

tractincome <- bind_rows(tractincome_2008, tractincome_2013, tractincome_2018) %>%
  spread(key = year, value = estimate) %>%
  rename("year_2008" = "2009") %>%
  rename("year_2013" = "2013") %>%
  rename("year_2018" = "2018") %>%
  mutate(location = "Census Tract 8509.04") %>%
  mutate(variable = "median household income") %>%
  mutate(pct_change_5 = round((year_2013-year_2008)/year_2008*100,1)) %>%
  mutate(pct_change_10 = round((year_2018-year_2008)/year_2008*100,1)) %>%
  mutate(pct_change_5_to_10 = round((year_2018-year_2013)/year_2013*100,1)) %>%
  select(variable, location, year_2008:year_2018, pct_change_5:pct_change_5_to_10)

#TRACT COMP
# Note: starting point here is ACS5 2009
tractcompincome_2008 <- tractcomp_2009 %>%
  filter(variable == "medi_house_income") %>%
  select(year, estimate)

tractcompincome_2013 <- tractcomp_2013 %>%
  filter(variable == "medi_house_income") %>%
  select(year, estimate)

tractcompincome_2018 <- tractcomp_2018 %>%
  filter(variable == "medi_house_income") %>%
  select(year, estimate)

tractcompincome <- bind_rows(tractcompincome_2008, tractcompincome_2013, tractcompincome_2018) %>%
  spread(key = year, value = estimate) %>%
  rename("year_2008" = "2009") %>%
  rename("year_2013" = "2013") %>%
  rename("year_2018" = "2018") %>%
  mutate(location = "Census Tract 8508.02_comparison") %>%
  mutate(variable = "median household income") %>%
  mutate(pct_change_5 = round((year_2013-year_2008)/year_2008*100,1)) %>%
  mutate(pct_change_10 = round((year_2018-year_2008)/year_2008*100,1)) %>%
  mutate(pct_change_5_to_10 = round((year_2018-year_2013)/year_2013*100,1)) %>%
  select(variable, location, year_2008:year_2018, pct_change_5:pct_change_5_to_10)

# ALL TOGETHER
income <- bind_rows(mdincome, charlesincome, wincome, tractincome, tractcompincome)

# CSV
write_csv(income, file = "income.csv")

```

```{r}

#EDUCATION - this one works differently than the templates above
#Will calculate as percentage of people with a bachelor's degree

#STATE
# Note: starting point here is ACS3 2007
mdbachelors_2008 <- md_2007 %>%
  filter(variable == "education_total"|variable == "education_bachelors") %>%
  mutate(pct = round(estimate/estimate[variable == "education_total"]*100,1)) %>%
  filter(variable == "education_bachelors") %>%
  select(year, pct)

mdbachelors_2013 <- md_2013 %>%
  filter(variable == "education_total"|variable == "education_bachelors") %>%
  mutate(pct = round(estimate/estimate[variable == "education_total"]*100,1)) %>%
  filter(variable == "education_bachelors") %>%
  select(year, pct)

mdbachelors_2018 <- md_2018 %>%
  filter(variable == "education_total"|variable == "education_bachelors") %>%
  mutate(pct = round(estimate/estimate[variable == "education_total"]*100,1)) %>%
  filter(variable == "education_bachelors") %>%
  select(year, pct)

mdbachelors <- bind_rows(mdbachelors_2008, mdbachelors_2013, mdbachelors_2018) %>%
  spread(key = year, value = pct) %>%
  rename("year_2008" = "2007") %>%
  rename("year_2013" = "2013") %>%
  rename("year_2018" = "2018") %>%
  mutate(location = "Maryland") %>%
  mutate(variable = "pct with bachelors degrees") %>%
  mutate(pct_change_5 = year_2013-year_2008) %>%
  mutate(pct_change_10 = year_2018-year_2008) %>%
  mutate(pct_change_5_to_10 = year_2018-year_2013) %>%
  select(variable, location, year_2008:year_2018, pct_change_5:pct_change_5_to_10)

#COUNTY
# Note: starting point here is ACS3 2007
charlesbachelors_2008 <- charles_2007 %>%
  filter(variable == "education_total"|variable == "education_bachelors") %>%
  mutate(pct = round(estimate/estimate[variable == "education_total"]*100,1)) %>%
  filter(variable == "education_bachelors") %>%
  select(year, pct)

charlesbachelors_2013 <- charles_2013 %>%
  filter(variable == "education_total"|variable == "education_bachelors") %>%
  mutate(pct = round(estimate/estimate[variable == "education_total"]*100,1)) %>%
  filter(variable == "education_bachelors") %>%
  select(year, pct)

charlesbachelors_2018 <- charles_2018 %>%
  filter(variable == "education_total"|variable == "education_bachelors") %>%
  mutate(pct = round(estimate/estimate[variable == "education_total"]*100,1)) %>%
  filter(variable == "education_bachelors") %>%
  select(year, pct)

charlesbachelors <- bind_rows(charlesbachelors_2008, charlesbachelors_2013, charlesbachelors_2018) %>%
  spread(key = year, value = pct) %>%
  rename("year_2008" = "2007") %>%
  rename("year_2013" = "2013") %>%
  rename("year_2018" = "2018") %>%
  mutate(location = "Charles County") %>%
  mutate(variable = "pct with bachelors degrees") %>%
  mutate(pct_change_5 = year_2013-year_2008) %>%
  mutate(pct_change_10 = year_2018-year_2008) %>%
  mutate(pct_change_5_to_10 = year_2018-year_2013) %>%
  select(variable, location, year_2008:year_2018, pct_change_5:pct_change_5_to_10)

#CITY
# Note: starting point here is ACS3 2007
wbachelors_2008 <- w_2007 %>%
  filter(variable == "education_total"|variable == "education_bachelors") %>%
  mutate(pct = round(estimate/estimate[variable == "education_total"]*100,1)) %>%
  filter(variable == "education_bachelors") %>%
  select(year, pct)

wbachelors_2013 <- w_2013 %>%
  filter(variable == "education_total"|variable == "education_bachelors") %>%
  mutate(pct = round(estimate/estimate[variable == "education_total"]*100,1)) %>%
  filter(variable == "education_bachelors") %>%
  select(year, pct)

wbachelors_2018 <- w_2018 %>%
  filter(variable == "education_total"|variable == "education_bachelors") %>%
  mutate(pct = round(estimate/estimate[variable == "education_total"]*100,1)) %>%
  filter(variable == "education_bachelors") %>%
  select(year, pct)

wbachelors <- bind_rows(wbachelors_2008, wbachelors_2013, wbachelors_2018) %>%
  spread(key = year, value = pct) %>%
  rename("year_2008" = "2007") %>%
  rename("year_2013" = "2013") %>%
  rename("year_2018" = "2018") %>%
  mutate(location = "Waldorf") %>%
  mutate(variable = "pct with bachelors degrees") %>%
  mutate(pct_change_5 = year_2013-year_2008) %>%
  mutate(pct_change_10 = year_2018-year_2008) %>%
  mutate(pct_change_5_to_10 = year_2018-year_2013) %>%
  select(variable, location, year_2008:year_2018, pct_change_5:pct_change_5_to_10)

#TRACT 2008
# Note: starting point here is ACS5 2009
# Needed ChatGPT's help to figure out middle two steps - in this case, total number of bachelors needs to be a sum of men + women

tractbachelors_2008 <- tract_2009 %>%
  filter(variable == "education_total"|variable == "education_men_bachelors"|variable == "education_women_bachelors")

new_row_bachelors <- tibble(GEOID = "24017850904",
                  NAME = "Census Tract 8509.04, Charles County, Maryland",
                  variable = "education_bachelors",
                  estimate = sum(tractbachelors_2008$estimate[tractbachelors_2008$variable %in% c("education_men_bachelors", "education_women_bachelors")]),
                  moe = NA,
                  year = 2009)

tractbachelors_2008 <- tractbachelors_2008 %>%
  add_row(new_row_bachelors)

tractbachelors_2008 <- tractbachelors_2008 %>%
  filter(variable == "education_total"|variable == "education_bachelors") %>%
  mutate(pct = round(estimate/estimate[variable == "education_total"]*100,1)) %>%
  filter(variable == "education_bachelors") %>%
  select(year, pct)

#TRACT REMAINING STEPS

tractbachelors_2013 <- tract_2013 %>%
  filter(variable == "education_total"|variable == "education_bachelors") %>%
  mutate(pct = round(estimate/estimate[variable == "education_total"]*100,1)) %>%
  filter(variable == "education_bachelors") %>%
  select(year, pct)

tractbachelors_2018 <- tract_2018 %>%
  filter(variable == "education_total"|variable == "education_bachelors") %>%
  mutate(pct = round(estimate/estimate[variable == "education_total"]*100,1)) %>%
  filter(variable == "education_bachelors") %>%
  select(year, pct)

tractbachelors <- bind_rows(tractbachelors_2008, tractbachelors_2013, tractbachelors_2018) %>%
  spread(key = year, value = pct) %>%
  rename("year_2008" = "2009") %>%
  rename("year_2013" = "2013") %>%
  rename("year_2018" = "2018") %>%
  mutate(location = "Census Tract 8509.04") %>%
  mutate(variable = "pct with bachelors degrees") %>%
  mutate(pct_change_5 = year_2013-year_2008) %>%
  mutate(pct_change_10 = year_2018-year_2008) %>%
  mutate(pct_change_5_to_10 = year_2018-year_2013) %>%
  select(variable, location, year_2008:year_2018, pct_change_5:pct_change_5_to_10)

#TRACT COMP 2008
# Note: starting point here is ACS5 2009

tractcompbachelors_2008 <- tractcomp_2009 %>%
  filter(variable == "education_total"|variable == "education_men_bachelors"|variable == "education_women_bachelors")

new_row_bachelors_comp <- tibble(GEOID = "24017850802",
                  NAME = "Census Tract 8508.02, Charles County, Maryland",
                  variable = "education_bachelors",
                  estimate = sum(tractcompbachelors_2008$estimate[tractcompbachelors_2008$variable %in% c("education_men_bachelors", "education_women_bachelors")]),
                  moe = NA,
                  year = 2009)

tractcompbachelors_2008 <- tractcompbachelors_2008 %>%
  add_row(new_row_bachelors_comp)

tractcompbachelors_2008 <- tractcompbachelors_2008 %>%
  filter(variable == "education_total"|variable == "education_bachelors") %>%
  mutate(pct = round(estimate/estimate[variable == "education_total"]*100,1)) %>%
  filter(variable == "education_bachelors") %>%
  select(year, pct)

#TRACT COMP REMAINING STEPS

tractcompbachelors_2013 <- tractcomp_2013 %>%
  filter(variable == "education_total"|variable == "education_bachelors") %>%
  mutate(pct = round(estimate/estimate[variable == "education_total"]*100,1)) %>%
  filter(variable == "education_bachelors") %>%
  select(year, pct)

tractcompbachelors_2018 <- tractcomp_2018 %>%
  filter(variable == "education_total"|variable == "education_bachelors") %>%
  mutate(pct = round(estimate/estimate[variable == "education_total"]*100,1)) %>%
  filter(variable == "education_bachelors") %>%
  select(year, pct)

tractcompbachelors <- bind_rows(tractcompbachelors_2008, tractcompbachelors_2013, tractcompbachelors_2018) %>%
  spread(key = year, value = pct) %>%
  rename("year_2008" = "2009") %>%
  rename("year_2013" = "2013") %>%
  rename("year_2018" = "2018") %>%
  mutate(location = "Census Tract 8508.02_comparison") %>%
  mutate(variable = "pct with bachelors degrees") %>%
  mutate(pct_change_5 = year_2013-year_2008) %>%
  mutate(pct_change_10 = year_2018-year_2008) %>%
  mutate(pct_change_5_to_10 = year_2018-year_2013) %>%
  select(variable, location, year_2008:year_2018, pct_change_5:pct_change_5_to_10)

# ALL TOGETHER
bachelors <- bind_rows(mdbachelors, charlesbachelors, wbachelors, tractbachelors, tractcompbachelors)

# CSV
write_csv(bachelors, file = "bachelors.csv")

```

```{r}

#REAL ESTATE TAX REVENUE

#Note: It does not appear that aggregate tax revenues were collected in 2007ACS3 (median only) and 2009ACS5 (no apparent tax variable). To represent 2008, we are using the 2010ACS5. This is in line with research that used 2010 census data as a starting point for measuring the impact of stadiums built in 2008.

#STATE
# Note: starting point here is ACS5 2010
mdtaxes_2008 <- get_acs(geography = "state",
                variables = c(real_estate_tax_aggregate = "B25090_001"),
              state = "MD",
              year = 2010) %>% 
  mutate(year = 2010) %>%
  select(year, estimate)

mdtaxes_2013 <- md_2013 %>%
  filter(variable == "real_estate_tax_aggregate") %>%
  select(year, estimate)

mdtaxes_2018 <- md_2018 %>%
  filter(variable == "real_estate_tax_aggregate") %>%
  select(year, estimate)

mdtaxes <- bind_rows(mdtaxes_2008, mdtaxes_2013, mdtaxes_2018) %>%
  spread(key = year, value = estimate) %>%
  rename("year_2008" = "2010") %>%
  rename("year_2013" = "2013") %>%
  rename("year_2018" = "2018") %>%
  mutate(location = "Maryland") %>%
  mutate(variable = "total real estate taxes paid") %>%
  mutate(pct_change_5 = round((year_2013-year_2008)/year_2008*100,1)) %>%
  mutate(pct_change_10 = round((year_2018-year_2008)/year_2008*100,1)) %>%
  mutate(pct_change_5_to_10 = round((year_2018-year_2013)/year_2013*100,1)) %>%
  select(variable, location, year_2008:year_2018, pct_change_5:pct_change_5_to_10)

#COUNTY
# Note: starting point here is ACS5 2010
charlestaxes_2008 <- get_acs(geography = "county",
                variables = c(real_estate_tax_aggregate = "B25090_001"),
              state = "MD",
              year = 2010) %>% 
  mutate(year = 2010) %>%
  filter(NAME == "Charles County, Maryland") %>%
  select(year, estimate)

charlestaxes_2013 <- charles_2013 %>%
  filter(variable == "real_estate_tax_aggregate") %>%
  select(year, estimate)

charlestaxes_2018 <- charles_2018 %>%
  filter(variable == "real_estate_tax_aggregate") %>%
  select(year, estimate)

charlestaxes <- bind_rows(charlestaxes_2008, charlestaxes_2013, charlestaxes_2018) %>%
  spread(key = year, value = estimate) %>%
  rename("year_2008" = "2010") %>%
  rename("year_2013" = "2013") %>%
  rename("year_2018" = "2018") %>%
  mutate(location = "Charles County") %>%
  mutate(variable = "total real estate taxes paid") %>%
  mutate(pct_change_5 = round((year_2013-year_2008)/year_2008*100,1)) %>%
  mutate(pct_change_10 = round((year_2018-year_2008)/year_2008*100,1)) %>%
  mutate(pct_change_5_to_10 = round((year_2018-year_2013)/year_2013*100,1)) %>%
  select(variable, location, year_2008:year_2018, pct_change_5:pct_change_5_to_10)

#CITY
# Note: starting point here is ACS5 2010
wtaxes_2008 <- get_acs(geography = "place",
                variables = c(real_estate_tax_aggregate = "B25090_001"),
              state = "MD",
              year = 2010) %>% 
  mutate(year = 2010) %>%
  filter(NAME == "Waldorf CDP, Maryland") %>%
  select(year, estimate)

wtaxes_2013 <- w_2013 %>%
  filter(variable == "real_estate_tax_aggregate") %>%
  select(year, estimate)

wtaxes_2018 <- w_2018 %>%
  filter(variable == "real_estate_tax_aggregate") %>%
  select(year, estimate)

wtaxes <- bind_rows(wtaxes_2008, wtaxes_2013, wtaxes_2018) %>%
  spread(key = year, value = estimate) %>%
  rename("year_2008" = "2010") %>%
  rename("year_2013" = "2013") %>%
  rename("year_2018" = "2018") %>%
  mutate(location = "Waldorf") %>%
  mutate(variable = "total real estate taxes paid") %>%
  mutate(pct_change_5 = round((year_2013-year_2008)/year_2008*100,1)) %>%
  mutate(pct_change_10 = round((year_2018-year_2008)/year_2008*100,1)) %>%
  mutate(pct_change_5_to_10 = round((year_2018-year_2013)/year_2013*100,1)) %>%
  select(variable, location, year_2008:year_2018, pct_change_5:pct_change_5_to_10)

#TRACT
# Note: starting point here is ACS5 2010
tracttaxes_2008 <- get_acs(geography = "tract",
                variables = c(real_estate_tax_aggregate = "B25090_001"),
              state = "MD",
              year = 2010) %>% 
  mutate(year = 2010) %>%
  filter(NAME == "Census Tract 8509.04, Charles County, Maryland") %>%
  select(year, estimate)

tracttaxes_2013 <- tract_2013 %>%
  filter(variable == "real_estate_tax_aggregate") %>%
  select(year, estimate)

tracttaxes_2018 <- tract_2018 %>%
  filter(variable == "real_estate_tax_aggregate") %>%
  select(year, estimate)

tracttaxes <- bind_rows(tracttaxes_2008, tracttaxes_2013, tracttaxes_2018) %>%
  spread(key = year, value = estimate) %>%
  rename("year_2008" = "2010") %>%
  rename("year_2013" = "2013") %>%
  rename("year_2018" = "2018") %>%
  mutate(location = "Census Tract 8509.04") %>%
  mutate(variable = "total real estate taxes paid") %>%
  mutate(pct_change_5 = round((year_2013-year_2008)/year_2008*100,1)) %>%
  mutate(pct_change_10 = round((year_2018-year_2008)/year_2008*100,1)) %>%
  mutate(pct_change_5_to_10 = round((year_2018-year_2013)/year_2013*100,1)) %>%
  select(variable, location, year_2008:year_2018, pct_change_5:pct_change_5_to_10)

#TRACT COMP
# Note: starting point here is ACS5 2010
tractcomptaxes_2008 <- get_acs(geography = "tract",
                variables = c(real_estate_tax_aggregate = "B25090_001"),
              state = "MD",
              year = 2010) %>% 
  mutate(year = 2010) %>%
  filter(NAME == "Census Tract 8508.02, Charles County, Maryland") %>%
  select(year, estimate)

tractcomptaxes_2013 <- tractcomp_2013 %>%
  filter(variable == "real_estate_tax_aggregate") %>%
  select(year, estimate)

tractcomptaxes_2018 <- tractcomp_2018 %>%
  filter(variable == "real_estate_tax_aggregate") %>%
  select(year, estimate)

tractcomptaxes <- bind_rows(tractcomptaxes_2008, tractcomptaxes_2013, tractcomptaxes_2018) %>%
  spread(key = year, value = estimate) %>%
  rename("year_2008" = "2010") %>%
  rename("year_2013" = "2013") %>%
  rename("year_2018" = "2018") %>%
  mutate(location = "Census Tract 8508.02_comparison") %>%
  mutate(variable = "total real estate taxes paid") %>%
  mutate(pct_change_5 = round((year_2013-year_2008)/year_2008*100,1)) %>%
  mutate(pct_change_10 = round((year_2018-year_2008)/year_2008*100,1)) %>%
  mutate(pct_change_5_to_10 = round((year_2018-year_2013)/year_2013*100,1)) %>%
  select(variable, location, year_2008:year_2018, pct_change_5:pct_change_5_to_10)

# ALL TOGETHER
taxes <- bind_rows(mdtaxes, charlestaxes, wtaxes, tracttaxes, tractcomptaxes)

# CSV
write_csv(taxes, file = "taxes.csv")

```

```{r}

#HOME PRICES

#STATE
# Note: starting point here is ACS3 2007
mdhomeprice_2008 <- md_2007 %>%
  filter(variable == "medi_home_value") %>%
  select(year, estimate)

mdhomeprice_2013 <- md_2013 %>%
  filter(variable == "medi_home_value") %>%
  select(year, estimate)

mdhomeprice_2018 <- md_2018 %>%
  filter(variable == "medi_home_value") %>%
  select(year, estimate)

mdhomeprice <- bind_rows(mdhomeprice_2008, mdhomeprice_2013, mdhomeprice_2018) %>%
  spread(key = year, value = estimate) %>%
  rename("year_2008" = "2007") %>%
  rename("year_2013" = "2013") %>%
  rename("year_2018" = "2018") %>%
  mutate(location = "Maryland") %>%
  mutate(variable = "median home value") %>%
  mutate(pct_change_5 = round((year_2013-year_2008)/year_2008*100,1)) %>%
  mutate(pct_change_10 = round((year_2018-year_2008)/year_2008*100,1)) %>%
  mutate(pct_change_5_to_10 = round((year_2018-year_2013)/year_2013*100,1)) %>%
  select(variable, location, year_2008:year_2018, pct_change_5:pct_change_5_to_10)

#COUNTY
# Note: starting point here is ACS3 2007
charleshomeprice_2008 <- charles_2007 %>%
  filter(variable == "medi_home_value") %>%
  select(year, estimate)

charleshomeprice_2013 <- charles_2013 %>%
  filter(variable == "medi_home_value") %>%
  select(year, estimate)

charleshomeprice_2018 <- charles_2018 %>%
  filter(variable == "medi_home_value") %>%
  select(year, estimate)

charleshomeprice <- bind_rows(charleshomeprice_2008, charleshomeprice_2013, charleshomeprice_2018) %>%
  spread(key = year, value = estimate) %>%
  rename("year_2008" = "2007") %>%
  rename("year_2013" = "2013") %>%
  rename("year_2018" = "2018") %>%
  mutate(location = "Charles County") %>%
  mutate(variable = "median home value") %>%
  mutate(pct_change_5 = round((year_2013-year_2008)/year_2008*100,1)) %>%
  mutate(pct_change_10 = round((year_2018-year_2008)/year_2008*100,1)) %>%
  mutate(pct_change_5_to_10 = round((year_2018-year_2013)/year_2013*100,1)) %>%
  select(variable, location, year_2008:year_2018, pct_change_5:pct_change_5_to_10)

#CITY
# Note: starting point here is ACS3 2007
whomeprice_2008 <- w_2007 %>%
  filter(variable == "medi_home_value") %>%
  select(year, estimate)

whomeprice_2013 <- w_2013 %>%
  filter(variable == "medi_home_value") %>%
  select(year, estimate)

whomeprice_2018 <- w_2018 %>%
  filter(variable == "medi_home_value") %>%
  select(year, estimate)

whomeprice <- bind_rows(whomeprice_2008, whomeprice_2013, whomeprice_2018) %>%
  spread(key = year, value = estimate) %>%
  rename("year_2008" = "2007") %>%
  rename("year_2013" = "2013") %>%
  rename("year_2018" = "2018") %>%
  mutate(location = "Waldorf") %>%
  mutate(variable = "median home value") %>%
  mutate(pct_change_5 = round((year_2013-year_2008)/year_2008*100,1)) %>%
  mutate(pct_change_10 = round((year_2018-year_2008)/year_2008*100,1)) %>%
  mutate(pct_change_5_to_10 = round((year_2018-year_2013)/year_2013*100,1)) %>%
  select(variable, location, year_2008:year_2018, pct_change_5:pct_change_5_to_10)

#TRACT
# Note: starting point here is ACS5 2009
tracthomeprice_2008 <- tract_2009 %>%
  filter(variable == "medi_home_value") %>%
  select(year, estimate)

tracthomeprice_2013 <- tract_2013 %>%
  filter(variable == "medi_home_value") %>%
  select(year, estimate)

tracthomeprice_2018 <- tract_2018 %>%
  filter(variable == "medi_home_value") %>%
  select(year, estimate)

tracthomeprice <- bind_rows(tracthomeprice_2008, tracthomeprice_2013, tracthomeprice_2018) %>%
  spread(key = year, value = estimate) %>%
  rename("year_2008" = "2009") %>%
  rename("year_2013" = "2013") %>%
  rename("year_2018" = "2018") %>%
  mutate(location = "Census Tract 8509.04") %>%
  mutate(variable = "median home value") %>%
  mutate(pct_change_5 = round((year_2013-year_2008)/year_2008*100,1)) %>%
  mutate(pct_change_10 = round((year_2018-year_2008)/year_2008*100,1)) %>%
  mutate(pct_change_5_to_10 = round((year_2018-year_2013)/year_2013*100,1)) %>%
  select(variable, location, year_2008:year_2018, pct_change_5:pct_change_5_to_10)

#TRACT COMP
# Note: starting point here is ACS5 2009
tractcomphomeprice_2008 <- tractcomp_2009 %>%
  filter(variable == "medi_home_value") %>%
  select(year, estimate)

tractcomphomeprice_2013 <- tractcomp_2013 %>%
  filter(variable == "medi_home_value") %>%
  select(year, estimate)

tractcomphomeprice_2018 <- tractcomp_2018 %>%
  filter(variable == "medi_home_value") %>%
  select(year, estimate)

tractcomphomeprice <- bind_rows(tractcomphomeprice_2008, tractcomphomeprice_2013, tractcomphomeprice_2018) %>%
  spread(key = year, value = estimate) %>%
  rename("year_2008" = "2009") %>%
  rename("year_2013" = "2013") %>%
  rename("year_2018" = "2018") %>%
  mutate(location = "Census Tract 8508.02_comparison") %>%
  mutate(variable = "median home value") %>%
  mutate(pct_change_5 = round((year_2013-year_2008)/year_2008*100,1)) %>%
  mutate(pct_change_10 = round((year_2018-year_2008)/year_2008*100,1)) %>%
  mutate(pct_change_5_to_10 = round((year_2018-year_2013)/year_2013*100,1)) %>%
  select(variable, location, year_2008:year_2018, pct_change_5:pct_change_5_to_10)

# ALL TOGETHER
medi_home_value <- bind_rows(mdhomeprice, charleshomeprice, whomeprice, tracthomeprice, tractcomphomeprice)

# CSV
write_csv(medi_home_value, file = "medi_home_value.csv")


```

